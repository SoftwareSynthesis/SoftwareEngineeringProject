% Documents/specifica_tecnica.tex
%------------------------ RUOLI PA --------------------------
% FASE 1:
% Progettisti: TRES, STEFANO, SCHIVO;
% FASE 2:
% Progettisti: DIEGO, ELENA, RIZZI
%
% Verificatore: MENE
% Responsabile finale: TRES
%------------------------------------------------------------

%------------------------ RUOLI PDC -------------------------
% FASE 1:
% Progettisti: STEFANO, RIZZI, SCHIVO, ELENA
%
% Verificatore: DIEGO
% Responsabile finale: RIZZI
%------------------------------------------------------------

% **************************************************
% Macro specifiche per il documento corrente
% **************************************************
% Nome
\newcommand{\docName}{Specifica tecnica}
% Nome file
\newcommand{\docFileName}{specifica\_tecnica.2.0.pdf}
% Versione
\newcommand{\docVers}{2.0}
% Data creazione
\newcommand{\creationDate}{2013-01-23}
% Data ultima modifica
\newcommand{\modificationDate}{2013-01-30}
% Stato in {Approvato, Non approvato}
\newcommand{\docState}{Approvato}
% Uso in {Interno, Esterno}
\newcommand{\docUsage}{Esterno}
% Destinatari da specificare come nome1\\ &nome2\\ ecc.
\newcommand{\docDistributionList}{Prof. Tullio Vardanega\\&Prof. Riccardo Cardin\\&Dott. Gregorio Piccoli\\&Team SoftwareSynthesis}
% Redattori da specificare come nome1\\ &nome2\\ ecc.
\newcommand{\docAuthors}{Andrea Rizzi\\&Elena Zecchinato\\&Marco Schivo\\&Stefano Farronato}
% Approvato da
\newcommand{\approvedBy}{Diego Beraldin}
% Verificatori
\newcommand{\verifiedBy}{Andrea Meneghinello}
% Perscorso (relativo o assoluto) che punta alla directory contenente shared/
% come sua sottodirectory (per comodità chiamiamola 'doc root').
\newcommand{\docRoot}{..}
% definire se si vuole l'indice delle tabelle
\def\INDICETABELLE{false}
% definire se si vuole l'indice delle figure
\def\INDICEFIGURE{true}

% importa il preambolo condiviso da tutti i documenti
\input{\docRoot/shared/preamble.tex}

% Fine del preambolo e inizio del documento
\begin{document}

% Inclusione della prima pagina
\input{\docRoot/shared/firstpage.tex}

% Storico delle modifiche
\section*{Storia delle modifiche}
\begin{center}
\begin{longtable}{lp{.32\textwidth}lll}
\toprule
Versione & Descrizione intervento & Membro & Ruolo & Data\\
\midrule
1.4 & Aggiornamento vantaggi del framework \inglese{Hibernate} & Andrea Rizzi & Progettista & 2013-02-11\\
1.3 & Correzione del modello dei dati & Marco Schivo & Progettista & 2013-02-11\\
1.2 & Aggiunta descrizione dei diagrammi di attività e correzione degli stessi & Stefano Farronato & Progettista & 2012-02-09\\
1.1 & Modifica architettura del database & Elena Zecchinato & Progettista & 2013-02-08\\

1.0 & Approvazione documento & Riccardo Tresoldi & Responsabile & 2013-01-30\\
0.19 & Correzione errori ortografici e di forma presenti nel documento in base alle segnalazioni del verificatore&Marco Schivo & Progettista & 2013-01-29\\
0.18 & Correzione diagrammi presenti nel documento in base alle segnalazioni del verificatore&Elena Zecchinato & Progettista & 2013-01-29\\
0.17 & Verifica lessico ortografica del documento & Andrea Meneghinello & Verificatore & 2013-01-28\\
0.16 & Verifica correttezza e corrispondenza dei diagrammi presenti nel documento & Stefano Farronato & Verificatore & 2013-01-27\\
0.15 & Inserimento tabelle di tracciamento prodotte nel capitolo 12&Diego Beraldin & Progettista & 2013-01-28\\
0.14 & Inserimento diagrammi delle attività e dei package prodotti nel capitolo 11&Diego Beraldin & Progettista & 2013-01-28\\
0.13 & Inserimento diagrammi delle classi nel capitolo 6, 7, 8, 9&Marco Schivo & Progettista & 2013-01-28\\
0.12 & Inserimento diagrammi relativi ai design pattern evidenziati&Marco Schivo & Progettista & 2013-01-28\\
0.11 & Inizio stesura capitolo relativo alla descrizione delle classi&Diego Beraldin & Progettista & 2013-01-27\\
0.10 & Stesura della sezione relativa all'architettura \texttt{mytalk.clientview} stilando i componenti evidenziati&Elena Zecchinato & Progettista & 2013-01-27\\
0.9 & Stesura della sezione relativa all'architettura \texttt{mytalk.clientpresenter} stilando i componenti evidenziati&Marco Schivo & Progettista & 2013-01-27\\
0.8 & Stesura della sezione relativa all'architettura \texttt{mytalk.server} stilando i componenti evidenziati&Marco Schivo & Progettista & 2013-01-26\\
0.7 & Stesura della sezione relativa alla progettazione logica &Diego Beraldin  & Progettista & 2013-01-26\\
0.6 & Completata la sezione relativa alla progettazione concettuale &Elena Zecchinato & Progettista & 2013-01-25\\
0.5 & Inizio stesura della sezione relativa alla progettazione concettuale con classi evidenziate in fase di progettazione &Elena Zecchinato& Progettista & 2013-01-24\\
0.4 & Descrizione dei design pattern evidenziati nella fase di progettazione. &Diego Beraldin & Progettista & 2013-01-24\\
0.3 & Aggiunto capitolo relativo agli strumenti utilizzati.& Marco Schivo & Progettista & 2013-01-23\\
0.2 & Stesura dell'introduzione ai design pattern. Stesura dell'introduzione ai tracciamenti. &Elena Zecchinato & Progettista & 2013-01-23\\
0.1 & Creazione del documento e stesura della sezione ``Introduzione''. &Diego Beraldin & Progettista & 2013-01-23\\
\bottomrule
\end{longtable}
\end{center}
\clearpage

% inclusione dell'indice
\input{\docRoot/shared/toc.tex}

% Alcuni aggiustamenti per le pagine
\pagenumbering{arabic}
\setcounter{page}{1}
\pagestyle{normal}

% Qui ha inizio il documento vero e proprio...
\clearpage

\begin{abstract}
Il presente documento illustra l'architettura del sistema ad alto livello e comprende una suddivisione di quest'ultima in sotto-architetture logiche, l'enumerazione e la descrizione dei componenti funzionali che le costituiscono nonché la decomposizione dei componenti nei package e, in ultima istanza, nelle classi. Vengono presentati inoltre gli elementi di riuso architetturale (\inglese{pattern}) utilizzati, motivandone la scelta. Infine, il documento è corredato da sei tabelle riepilogative inerenti al tracciamento componenti-requisiti, componenti-\underline{\inglese{design pattern}} e componenti-classi.
\end{abstract}
\clearpage

\section{Introduzione}
\subsection{Scopo del prodotto}
\purpose

\subsection{Scopo del documento}
Il presente documento è stato redatto al fine di produrre le specifiche sulla progettazione ad alto livello, del prodotto \caName. A tal fine il documento presenterà:
\begin{itemize}
    \item una descrizione degli strumenti e dei \underline{\inglese{framework}} su cui si basa l'architettura;
	\item un elenco con le specifiche dei \inglese{design pattern} utilizzati;
	\item l'architettura di alto livello del sistema;
	\item una descrizione dettagliata dei componenti rilevati in fase di progettazione indicando relativamente a ciascuno di essi il tipo, la funzione e l'obiettivo;
	\item i diagrammi UML per definire i flussi principali di controllo dell'applicativo;
	\item il tracciamento di requisiti e componenti;
	\item il tracciamento di componenti e \inglese{design pattern};
	\item il tracciamento di classi e componenti.
\end{itemize}

\subsection{Glossario}
\glossaryIntro

\clearpage
\section{Riferimenti}

\subsection{Normativi}
\begin{itemize}
\item[] \textit{piano\_di\_qualifica.3.0.pdf} allegato.
\item[] \textit{norme\_di\_progetto.3.0.pdf} allegato.
\item[] \textit{analisi\_dei\_requisiti.3.0.pdf} allegato
\end{itemize}

\subsection{Informativi}
\begin{itemize}
\item[] Capitolato d'appalto: \caName{}, v1.0, redatto e rilasciato dal proponente Zucchetti S.r.l. reperibile all'indirizzo \url{http://www.math.unipd.it/~tullio/IS-1/2012/Progetto/C1.pdf};
\item[] testo di consultazione: \textit{Software Engineering (8th edition) Ian Sommerville, Pearson Education | Addison Wesley};
\item[] manuale all'utilizzo dei design pattens: \textit{Design Patterns, Elementi per il riuso di software a oggetti -- (1/Ed. italiana) Eric Gamma, Richard Helm, Ralph Johnson, John Vlissides, Pearson Education};
\item[] manuale di basi di dati: \textit{Sistemi di basi di dati-fondamenti} -- (6° edizione) Ramez Elmasri / Shamkant B. Navathe
\item[] \textit{glossario.3.0.pdf} allegato.
\end{itemize}
\clearpage

\section{Strumenti utilizzati}

\subsection{Java}
L'utilizzo del linguaggio \underline{Java} è richiesto dal proponente esclusivamente per la realizzazione della componente \underline{server}.

\subsubsection*{Vantaggi}
\begin{itemize}[noitemsep,nolistsep]
\item[-] è un linguaggio predisposto nativamente alla gestione parallela di \inglese{thread} e questo applicato ad un server dà la possibilità di gestire parallelamente richieste da parte di più utenti allo stesso tempo;
\item[-] essendo un linguaggio orientato agli oggetti e fortemente tipizzato si presta all'applicazione di \inglese{design pattern} e alla costruzione di un'architettura robusta, fortemente modulare e al contempo flessibile, in accordo con i principi del paradigma di programmazione OO;
\item[-] permette la generazione automatica della documentazione con l'ausilio di JavaDoc;
\item[-] garantisce la portabilità del codice (a livello di bytecode), l'indipendenza dalla piattaforma fisica di esecuzione grazie alla JVM e l'integrazione nell'ambiente di esecuzione del proponente (\underline{TomCat}).
\end{itemize}

 
\subsection{Web server Apache}

La struttura dell'applicativo si basa su pagine web scritte in \underline{HTML5}. Ciò richiede la presenza di un server web dove collocare le pagine richiamabili dai browser degli utenti.

\subsubsection*{Vantaggi}

\begin{itemize}[noitemsep,nolistsep]
  \item[-] diversi membri del team hanno già lavorato su tale struttura, il costo in termini di tempo per istruire il personale è dunque ridotto al minimo;
  \item[-] Apache offre funzioni di controllo per la sicurezza come quelli che compie il \inglese{proxy};
\end{itemize}
  
\subsection{RDBMS MySQL}

Ogni utente avrà a disposizione diversi dati consultabili e modificabili in diverse aree dell'applicativo. Per esempio, un utente sarà interessato a gestire i propri dati personali.

Ciò richiede che l'applicativo sia dotato di un sistema di memorizzazione permanente dei dati. A tale scopo si è scelto di usare un RDBMS (\inglese{relational database management system}) e nello specifico  il team intende appoggiarsi ad un server MySQL\@.

\subsubsection*{Vantaggi}

\begin{itemize}[noitemsep,nolistsep]
  \item[-] come per Apache, anche per questo sistema si stima che costi per istruire i personali saranno minimi, poiché i membri del team hanno già avuto modo di utilizzare tale strumento;
  \item[-] uno dei principali strumenti d'amministrazione di un database MySQL è phpMyAdmin. Il team conta di utilizzarlo in virtù dell'intuitività con cui è costruita l'interfaccia grafica;
  \item[-] tale DBMS supporta le transazioni, essenziali nel nostro progetto per la manipolazione e la lettura dei dati memorizzati.
\end{itemize}

\subsection{Servlet container TomCat}

L'applicativo dovrà disporre di un lato server ed un lato client. Se da una parte il lato client è rappresentato dall'ambiente di esecuzione del browser che ha il compito di visualizzare una pagina web fornita tramite un server Apache ed eseguire gli \inglese{script} ad essa associati, dall'altra l'applicativo server sarà strutturato tramite delle \inglese{servlet} Java che, per conformità con i software usati, saranno caricate nel \inglese{servlet container} di TomCat che si appoggia sul già citato Apache.

\subsubsection*{Vantaggi}

\begin{itemize}[noitemsep,nolistsep]
  \item[-] Alcuni membri del gruppo hanno già lavorato in passato con Tomcat; la loro esperienza potrà tornare utile velocizzando la fase d'apprendimento, da parte dei membri che ancora non lo conoscono.
\end{itemize}

\subsection{Hibernate}\label{sec:hibernate}

Hibernate è un \inglese{framework} Java utilizzato per facilitare l'utilizzo di un \underline{database} da parte del server realizzando la mappatura fra oggetti intesi in senso OOP ed ennuple del modello relazionale (\inglese{object-relational mapping}).

\subsubsection*{Vantaggi}
\begin{itemize}[noitemsep,nolistsep]
\item[-] Hibernate permette di utilizzare le tabelle di un database relazionale come se fossero degli oggetti mappando il database su di opportune classi strutturate ad-hoc svincolando la gestione della persistenza dei dati dalla logica di business;
\item[-] con questo \inglese{framework} Java riesce a lavorare su un database rendendo trasparenti al programmatore le vere e proprie \inglese{query} e mostrando esclusivamente classi e metodi; Lo sviluppatore è inoltre esonerato dalla gestione dei risultati di chiamate SQL e la loro eventuale conversione in oggetti.
\item[-] essendo rilasciato sotto licenza LGPL può essere utilizzato senza restrizioni (\inglese{copyleft}) e vincoli di licenza delle opere derivate.
\item[-] l'applicazione rimane portabile in tutti i sistemi di gestione supportati, con un basso \inglese{overhead}.
\end{itemize}
\clearpage

\section{Introduzione all'architettura di sistema}\label{sec:introdesign}
Per introdurre l'architettura proposta è essenziale mettere in evidenza le seguenti considerazioni:
\begin{itemize}
	\item il sistema poggia su un database nel quale sono contenuti i dati d'interesse per gli utenti (dati anagrafici, lista dei messaggi audio, lista dei messaggi audio e video, la rubrica dei contatti e lo storico delle chiamate);
	\item il sistema proposto dal team è dotato di una parte server e una parte client;
	\item dopo un'analisi preliminare il team ha stabilito che la progettazione del server non deve essere vincolata da quella del client in modo tale da evitare che il progetto dell'applicativo lato server abbia la cognizione di come funziona il client. Ciò permetterà un futuro riutilizzo del codice (e.g. se si desiderasse creare un nuovo applicativo di tipo \underline{VoIP} si potrà riutilizzare il server già creato);
	\item per quanto riguarda il lato client, al fine di garantire un alto livello di riutilizzo del codice e la possibilità di eseguire manutenzioni nel minor tempo possibile, si vuole che la logica d'implementazione del client sia svincolata dalla rappresentazione grafica del medesimo.
\end{itemize}

Tali considerazioni di base, hanno portato il team a suddividere l'architettura in tre sotto-architetture, intese anche come package, più una quarta architettura inerente la struttura del database:
\begin{itemize}
	\item il database;
	\item il server (\texttt{org.softwaresynthesis.mytalk.server});
	\item il presenter del client (\texttt{org.softwaresynthesis.mytalk.clientpresenter});
	\item la vista del client (\texttt{org.softwaresynthesis.mytalk.clientview}
\end{itemize}

Le specifiche di ogni sotto-architettura saranno definite, rispettivamente nelle sezioni \vref{sec:database}, \vref{sec:server}, \vref{sec:clientpresenter} e \vref{sec:clientview}.

Inoltre si fa presente che l'architettura generale, intesa come agglomerato delle tre sotto-architetture precedentemente elencate, fa uso del pattern MVP\@.

Sotto tale ottica la sotto-architettura \texttt{server} ricopre il ruolo di \inglese{model}, \texttt{clientpresenter} costituisce invece il \inglese{presenter}, mentre \texttt{clientview} è la vista definita per questo progetto. Tra le considerazioni più interessanti che hanno portato alla scelta di questo \inglese{pattern}, va messa in evidenza la seguente.

Assegnando a ogni sotto-architettura un ruolo specifico, si garantisce un alto livello di riutilizzo del codice (e.g. la vista comunica con il \inglese{presenter} poiché non conosce la logica di \inglese{business} del sistema).

Quindi in un futuro di potrebbe riprendere la vista oggi definita, e riutilizzarla in un altro progetto, andando solo a ridefinire, se necessario, un \inglese{presenter} che riproponga una nuovo adattamento della parte logica.

Nelle sezioni successive, per ogni sotto-architettura sarà fornito un elenco dettagliato dei componenti che lo interessano. Si sottolinea che per componenti non sono da intendersi i sotto-package, bensì gli agglomerati di classi (potenzialmente prese da package diversi) che concorrono ad un fine comune: la definizione delle funzionalità del componente trattato.

\begin{figure}[H]
\centering
  \includegraphics[width=.8\textwidth]{DiagrammaPackage}
  \caption{Diagramma dei package generale}\label{fig:packagegenerale}
\end{figure}
\clearpage

\subsection{Logica di rete}

\subsubsection{Descrizione della logica di connessione}
La rete che viene a crearsi sotto l'architettura di \caName{} è suddivisa in ``comunicazioni'', ovvero gruppi di due o più utenti che comunicano tra di loro. Ogni comunicazione è formata dalle singole ``connessioni'' tra i vari client.

Questo capitolo serve a spiegare quale è la logica che governa la rete. Iniziamo definendo i tipi di client che la popolano.
\begin{description}
	\item{\scshape\bfseries Nodo}\\
	Il Nodo è rappresentato da un semplice client che si trova all'interno di una comunicazione e che ha una unica connessione attiva verso un altro client.
	\item{\scshape\bfseries Supernodo}\\
	Il Supernodo è un client con funzione di server. È usato nelle comunicazioni tra tre o più utenti per smistare le connessioni di tutti facendosi carico del traffico dei client.
\end{description}

Vediamo nel dettaglio come avviene una comunicazione. Essa nasce sempre tra due utenti, nel momento in cui uno desidera iniziarla effettua una richiesta verso il server che la inoltra al destinatario.

La comunicazione nasce così come un'unica connessione tra due client in modalità \underline{\inglese{peer-to-peer}} dove entrambi gli utenti hanno il ruolo di Nodo. Una comunicazione potrà iniziare solo attraverso tale metodologia, in quanto non vengono aperte comunicazioni iniziali tra più di due utenti.

Da questa situazione uno dei due utenti può richiederne l'aggiunta di un ulteriore soggetto. Dopo questa richiesta, il Nodo che la ha eseguita diventa un Supernodo con attive sia la connessione con il vecchio Nodo sia quella con il nuovo Nodo appena aggiunto.

Questa operazione crea una connessione fra tre Nodi estendibile dal Supernodo e dagli altri Nodi attraverso una richiesta al Supernodo stesso.

%Solo il Supernodo può richiedere nuove connessioni al Server. Con ulteriori richieste i nuovi nodi si collegano al Supernodo con una connessione estendendo la comunicazione.

Ogni Nodo può togliersi dalla comunicazione chiudendo la connessione con il Supernodo. Se è il Supernodo stesso a volersi togliere dalla comunicazione, l'intera comunicazione cade e tutti gli utenti vendono disconnessi.

\subsubsection{L'idea iniziale}
La logica di gestione della rete scelta dal team può rendere poco stabile le comunicazioni. Tale problematica è stata analizzata a lungo, e al fine di rendere le comunicazioni più stabili e solide era stata presa in considerazione un ulteriore soluzione alternativa sempre basata sul modello concettuale di Nodi e Supernodi, tuttavia è stata scartata dopo una breve analisi preliminare.

La differenza principale di tale soluzione rispetto a quella adottata è nella gestione dinamica del Supernodo, che viene scelto in base alla sua capacità di banda e alla possibilità di mantenere attive, con la massima qualità, tutte le connessioni con i Nodi della comunicazione.

Questa soluzione avrebbe richiesto un test di qualità della rete per ogni Nodo verso il nuovo possibile Supernodo, operazione di difficile progettazione e con complessità elevata, pari a $\omega(n-1)$ con n Nodi attivi nella comunicazione.

Al fine di garantire sempre la migliore qualità di connessione era stata presa inoltre in considerazione l'idea di controllare periodicamente la qualità del Supernodo e degli altri Nodi in modo da sostituire il Supernodo se necessario. Purtroppo anche questa soluzione richiederebbe dei calcoli di complessità $\omega(n*(n-1))$ con n Nodi attivi nella comunicazione.

Con una corretta implementazione questa soluzione avrebbe permesso una migliore qualità del prodotto \caName, il gruppo ha tuttavia optato per la prima implementazione presentata in quanto le risorse disponibili non erano sufficienti per terminare la seconda.
\clearpage

\section{Architettura del database}\label{sec:database}

Come già citato nella parte introduttiva all'architettura, il server si appoggia ad un database dove sono registrati i dati del sistema. La progettazione di tale database passa per due fasi (come appreso dal manuale ``Sistemi di basi di dati''): la progettazione concettuale e la progettazione logica.

\subsection{Progettazione concettuale}
Lo scopo della progettazione concettuale è definire una struttura ``concettuale'' della base di dati.

Tale struttura non rappresenta quella finale pronta per la creazione sul DBMS, ma bensì un modello in grado di rappresentare il problema, svincolato da come esso debba essere logicamente rappresentato.

\subsubsection{Lista delle classi}

\begin{description}
	\item{\scshape\bfseries UserData}: è l'entità le cui istanze rappresentano gli utenti registrati nel sistema. UserData è caratterizzata dai seguenti attributi:

\begin{center}
\rowcolors{2}{lightblue}{llightblue}
\begin{tabular}{lccc}
\toprule
Nome attributo & Tipo & Opzionale & Vincoli\\
\midrule
E\_Mail & Varchar(100) & NO & Unique\\
Password & Char(41) & NO &\\
Question & Varchar(100) & NO &\\
Answer & Varchar(100) & NO &\\
Name & Varchar(100) & SÌ &\\
Surname & Varchar(100) & SÌ &\\
Picture & Varchar(150) & NO &\\
\bottomrule
\end{tabular}
\end{center}

	\item{\scshape\bfseries AddressBookEntries}: è l'entità le cui istanze rappresentano i contatti appartenenti alla rubrica di un utente. AddressBookEntries è caratterizzata dai seguenti attributi:
	
\begin{center}
\rowcolors{2}{lightblue}{llightblue}
\begin{tabular}{lccc}
\toprule
Nome attributo & Tipo & Opzionale & Vincoli\\
\midrule
Blocked & Boolean & NO & default(false)\\
\bottomrule
\end{tabular}
\end{center}

	\item{\scshape\bfseries Calls}: è l'entità le cui istanze rappresentano le chiamate effettuate attraverso il sistema software \caName. Calls è caratterizzata dai seguenti attributi:

\begin{center}
\rowcolors{2}{lightblue}{llightblue}
\begin{tabular}{lccc}
\toprule
Nome attributo & Tipo & Opzionale & Vincoli\\
\midrule
Start\_date & Timestamp & NO & default(current\_timestamp)\\
End\_date & Timestamp & SÌ & \\
\bottomrule
\end{tabular}
\end{center}

	\item{\scshape\bfseries Groups}: è l'entità le cui istanze rappresentano un gruppo della rubrica di un utente. Tale entità è costituita dagli attributi:

\begin{center}
\rowcolors{2}{lightblue}{llightblue}
\begin{tabular}{lccc}
\toprule
Nome attributo & Tipo & Opzionale & Vincoli\\
\midrule
Name & Varchar(100) & NO &\\
\bottomrule
\end{tabular}
\end{center}	
	
	\item{\scshape\bfseries Messages}: è l'entità che rappresenta le informazioni basilari di un messaggio della segreteria dell'utente. Gli attributi che la compongono sono:

\begin{center}
\rowcolors{2}{lightblue}{llightblue}
\begin{tabular}{lccc}
\toprule
Nome attributo & Tipo & Opzionale & Vincoli\\
\midrule
New & Boolean & NO & \\
Start\_date & Timestamp & NO & default(current\_timestamp) \\
\bottomrule
\end{tabular}
\end{center}	
	
	\item{\scshape\bfseries AudioMessages}: è un'entità che specializza Messages e rappresenta i messaggi audio lasciati nella segreteria di un utente. L'entità non è caratterizzata da alcun attributo proprio.
	
	\item{\scshape\bfseries AudioVideoMessages}: è un'entità che specializza Messages e rappresenta i messaggi audio/video lasciati nella segreteria di un utente.  L'entità non è caratterizzata da alcun attributo proprio.	
	
\end{description}

\subsubsection{Gerarchia tra classi}

\begin{description}
	\item{\scshape\bfseries Messages (AudioMessages e AudioVideoMessages)}: i messaggi si suddividono logicamente in due categorie, i messaggi dotati solamente di traccia audio e quelli aventi anche una traccia video. Gli attributi contenuti in queste entità sono gli stessi.
	
Infatti la necessità di mostrare la separazione deriva dalla volontà del team di evidenziare la distinzione tra i due oggetti, motivata dalla possibilità di gestire le istanze delle due entità in modo diverso.
\end{description}

\subsubsection{Associazione tra classi}

\begin{description}
	\item{\scshape\bfseries UserData - Calls (molti a molti)}: tale associazione rappresenta il legame che intercorre tra gli utenti e le chiamate. Tale associazione è del tipo molti a molti, con totalità parziale verso Calls e totalità totale verso UserData. L'associazione prevede l'attributo 'Caller' che identifica chi è stato il primo utente ad avviare la chiamata.
	
	\item{\scshape\bfseries UserData - AddressBookEntries (uno a molti)}: tale associazione rappresenta il legame che intercorre tra un utente, il possessore della rubrica, e l'insieme dei contatti presenti in essa. Tale associazione è di tipo uno a molti, con totalità totale verso Userdata e parziale verso AddressBookEntries.
	
	\item{\scshape\bfseries AddressBookEntries - UserData (uno a uno)}: Tale associazione rappresenta il proprietario, univoco, di ogni contatto della rubrica. Tale associazione è del tipo uno a uno con totalità parziale da UserData verso AddressBookEntries mentre ha totalità totale da AddressBookEntries verso UserData.
	
	\item{\scshape\bfseries AddressBookEntries - Groups (molti a uno)}: tale associazione rappresenta la possibilità di suddividere la propria rubrica in gruppi di contatti. Tale associazione è del tipo molti a uno, con totalità totale da Groups ad AddressBookEntries mentre ha una totalità parziale da AddressBookEntries a Groups.
	
	\item{\scshape\bfseries UserData - Messages (uno a molti)}: tali associazioni rappresentano il legame che intercorre tra gli utenti ed i messaggi registrati nella propria segreteria. Le associazioni sono del tipo uno a molti verso Messages, con totalità parziale verso Messages e totalità totale verso UserData. L'idea alla base è che un utente può avere nella propria segreteria uno o più messaggi, così come può non averne nessuno, mentre ogni messaggio della segreteria è associato a un mittente e a un destinatario.
\end{description}

\subsection{Progettazione logica}
La progettazione logica ha la finalità di costruire la struttura definitiva del database a partire da quanto stabilito in sede di progettazione concettuale.

Pertanto, si deciderà come trasformare le gerarchie e in seguito le associazioni, al fine di restituire una struttura chiara e pronta per la creazione sul DBMS\@. La lista delle classi proposta e lo schema associato, rappresentano tale struttura.

\subsubsection{Rappresentazione delle gerarchie}

\begin{description}
	\item{\scshape\bfseries Messages(AudioMessages e AudioVideoMessages)}: al fine di evidenziare la suddivisione logica tra le due tipologie di messaggi, è stato deciso di trasformare la specializzazione di Messages con una tabella unica contenente un discriminante. È rimasta esclusivamente l'entità Messages a cui è stato aggiunto l'attributo ``Audio'' con la funzione di discriminare le due tipologie di messaggi.
\end{description}

\subsubsection{Rappresentazione delle associazioni}

\begin{description}
	\item{\scshape\bfseries UserData - Calls}: tale associazione si è risolta attraverso l'introduzione dell'entità CallLists. Tale entità contiene l'attributo ID\_user come chiave esterna verso l'entità UserData e l'attributo ID\_call come chiave esterna verso l'entità Calls. È dotata inoltre dell'attributo ``Caller'' che identifica colui che ha per primo avviato la chiamata; per ogni gruppo di ennuple aventi lo stesso ID\_call si avrà soltanto una ennupla contrassegnata con il campo Caller a vero.
	
	\item{\scshape\bfseries UserData - AddressBookEntries}: tali associazioni si sono risolte inserendo nell'entità AddressBookEntries due chiavi esterne verso UserData.
	
	\item{\scshape\bfseries AddressBookEntries - Groups}: tale associazione si è risolta inserendo una chiave esterna verso Groups all'interno dell'entità AddressBookEntries.
	
	\item{\scshape\bfseries UserData - Messages}: tale associazione si è risolta inserendo due chiavi esterne verso UserData all'interno dell'entità Messages. 
\end{description}

\subsubsection{Chiavi primarie sintetiche}
I progettisti hanno optato per la definizione di chiavi primarie sintetiche, ovvero chiavi generate automaticamente all'inserimento di un nuovo \inglese{record} nelle tabelle corrispondenti alle entità.

Tale scelta è dettata dall'utilizzo del framework Hibernate che non permette la modifica del valore della chiavi primarie associate ad una istanza di un oggetto di \inglese{business}. Le chiavi saranno quindi composte da un campo a valore intero, da intendersi come un contatore che identifica univocamente i record.

La chiave sintetiche adottate sono del tipo \texttt{BIGINT} senza segno, il team è consapevole che questo impone un limite di $1,8 \times10^{19}$ al numero di voci che possono essere memorizzate contemporaneamente in ogni entità.

Una soluzione da adottarsi in futuro per evitare la perdita di dati potrebbe consistere nello spostare da database a disco parte di queste informazioni.
L'introduzione di questo tipo di chiave è dovuta anche ad una semplice gestione, tramite Hibernate, di tale oggetto.

Nel caso particolare dei messaggi, inoltre, il campo ID\_message, oltre a rappresentare un identificatore univoco, coincide anche con il nome del file sul server in cui è memorizzato il messaggio stesso, all'interno di una \inglese{directory} predefinita e nota ai componenti del sistema.
\clearpage

\subsubsection{Lista delle classi}

\begin{center}

\rowcolors{3}{lightblue}{llightblue}
\begin{tabular}{lccc}
\toprule
\multicolumn{4}{c}{\scshape\bfseries UserData}\\
\midrule
Nome attributo & Tipo & Opzionale & Vincoli\\
\midrule
ID\_user & Bigint unsigned & NO & PrimaryKey\\
E-Mail & Varchar(100) & NO & Unique\\
Password & Char(41) & NO &\\
Question & Varchar(100) & NO &\\
Answer & Varchar(100) & NO &\\
Name & Varchar(100) & SÌ &\\
Surname & Varchar(100) & SÌ &\\
Picture & Varchar(150) & SÌ &\\
\bottomrule
\end{tabular}

\bigskip

\rowcolors{3}{lightblue}{llightblue}
\begin{tabular}{lccc}
\toprule
\multicolumn{4}{c}{\scshape\bfseries Calls}\\
\midrule
Nome attributo & Tipo & Opzionale & Vincoli\\
\midrule
ID\_call & Bigint unsigned & NO & PrimaryKey\\
Start\_date & Datetime & NO & default(current\_timestamp)\\
End\_date & Datetime & SÌ &\\
\bottomrule
\end{tabular}

\bigskip

\rowcolors{3}{lightblue}{llightblue}
\begin{tabular}{lccc}
\toprule
\multicolumn{4}{c}{\scshape\bfseries CallLists}\\
\midrule
Nome attributo & Tipo & Opzionale & Vincoli\\
\midrule
ID\_callList & Bigint unsigned & NO & PrimaryKey\\
ID\_call & Bigint unsigned & NO & ForeignKey verso Calls\\
ID\_user & Bigint unsigned & NO & ForeignKey verso UserData \\
Caller & Boolean & NO &\\
\bottomrule
\end{tabular}

\bigskip

\rowcolors{3}{lightblue}{llightblue}
\begin{tabular}{lccc}
\toprule
\multicolumn{4}{c}{\scshape\bfseries AddressBookEntries}\\
\midrule
Nome attributo & Tipo & Opzionale & Vincoli\\
\midrule
ID\_addressBookEntry & Bigint unsigned & NO & PrimaryKey\\
ID\_user & Bigint unsigned & NO & ForeignKey verso UserData\\
ID\_group & Bigint unsigned & SI & ForeignKey verso Groups\\
Owner & Bigint unsigned & NO & \\
Blocked & Boolean & NO & default(false)\\
\bottomrule
\end{tabular}

\bigskip

\rowcolors{3}{lightblue}{llightblue}
\begin{tabular}{lccc}
\toprule
\multicolumn{4}{c}{\scshape\bfseries Groups}\\
\midrule
Nome attributo & Tipo & Opzionale & Vincoli\\
\midrule
ID\_group & Bigint unsigned & NO & PrimaryKey\\
Name & Varchar(100) & NO & \\
\bottomrule
\end{tabular}

\bigskip

\rowcolors{3}{lightblue}{llightblue}
\begin{tabular}{lccc}
\toprule
\multicolumn{4}{c}{\scshape\bfseries Messages}\\
\midrule
Nome attributo & Tipo & Opzionale & Vincoli\\
\midrule
ID\_message & Bigint unsigned & NO & PrimaryKey\\
Sender & Bigint unsigned & NO & ForeignKey verso UserData \\
Receiver & Bigint unsigned & NO & ForeignKey verso UserData\\
New & Boolean & NO & default(true)\\
Audio & Boolean & NO & default(true)\\
Start\_date & Datetime & NO & default(current\_timestamp)\\
\bottomrule
\end{tabular}

\end{center}

\subsubsection{Diagramma delle classi}
\begin{figure}[H]
\begin{center}
\includegraphics[width=.9\textwidth]{Database_logico}
\caption{Diagramma delle classi - Schema logico database}\label{fig:database_logico}
\end{center}
\end{figure}
\clearpage


\section{Architettura \texttt{mytalk.server}}\label{sec:server}
Tale sotto-architettura definisce le specifiche e le funzionalità dell'applicativo lato server. In esso saranno definiti i seguenti componenti:
\begin{itemize}[noitemsep,nolistsep]
	\item[-] \textsf{CS01 -- Gestione database};
	\item[-] \textsf{CS02 -- Gestione connessione};
	\item[-] \textsf{CS03 -- Gestione rubrica};
	\item[-] \textsf{CS04 -- Gestione autenticazione};
	\item[-] \textsf{CS05 -- Gestione segreteria};
	\item[-] \textsf{CS06 -- Gestione chiamate};
	\item[-] \textsf{CS07-- Façade del server}.
\end{itemize}

I componenti sopracitati verranno definiti, rispettivamente, nelle sottosezioni \ref{sec:cs01}, \ref{sec:cs02}, \ref{sec:cs03}, \ref{sec:cs04}, \ref{sec:cs05}, \ref{sec:cs06} e \ref{sec:cs07}. Si sottolinea sin da ora che il server è l'unico in grado di comunicare con il database su cui regge l'applicativo.

Infine, si fa notare che i nomi di tutte le classi riportate nella presente sezione sono implicitamente parte del package \texttt{org.softwaresynthesis.mytalk.server}, pertanto tale prefisso sarà omesso nella loro denominazione.

\subsection{Componenti evidenziati}

\subsubsection{CS01 -- Gestione database}\label{sec:cs01}
\begin{description}
\item{\scshape\bfseries Descrizione:}\\
È il componente che si occupa di rappresentare la struttura del database relazionale su cui poggia l'applicativo. Tramite questo componente, il sistema potrà quindi effettuare operazione di lettura e scrittura di entità all'interno del database.

Nucleo logico di tale componente è la classe Singleton \texttt{HibernateUtil}, il cui compito è implementare una \inglese{factory} per le sessioni verso il database. Tali sessioni si basano sul file di configurazione di Hibernate, tra le cui informazioni compare anche la tipologia di di DBMS utilizzata.

Le restanti classi che fanno parte  di questo componente possono essere suddivise in due categorie:
\begin{itemize}
	\item le classi \inglese{data access object} (DAO), che hanno il compito di inoltrare richieste per la modifica e la lettura dei dati (\inglese{Create}, \inglese{Read}, \inglese{Update} e \inglese{Delete}) nelle corrispondenti entità del database.
	
	Tali classi sono:
	\begin{itemize}
	  \item[-] \texttt{dao.AddressBookEntryDAO}
		\item[-] \texttt{dao.CallDAO}
		\item[-] \texttt{dao.GroupDAO}
		\item[-] \texttt{dao.MessageDAO}
		\item[-] \texttt{dao.UserDataDAO}
	\end{itemize}
	
	\item le classi che mappano le entità rappresentate nel database sono dotate di variabili di istanza che corrispondono ai campi dei \inglese{record}. Le operazioni disponibili su questo genere di oggetti comprendono i metodi \inglese{get}/\inglese{set} associati ai campi delle tabelle del database e sono rese disponibili dalle interfacce (una per ogni entità) implementate dalle classi.\footnote{%
	Per chiarezza, si precisa che tali classi corrispondono a quelle che nella logica di programmazione in Hibernate prendono il nome di \inglese{Transfer Object} (TO)\@.
	}
	\begin{itemize}
	  \item[-] \texttt{abook.IGroup}
	  \item[-] \texttt{abook.Group}
	  \item[-] \texttt{abook.IAddressBookEntry}
	  \item[-] \texttt{abook.AddressBookEntry}
	  \item[-] \texttt{abook.IUserData}
	  \item[-] \texttt{abook.UserData}
		\item[-] \texttt{call.ICall}
	  \item[-] \texttt{call.Call}
	  \item[-] \texttt{message.IMessage}
	  \item[-] \texttt{message.Message}
	\end{itemize}
\end{itemize}

Le classi rappresentanti i \inglese{transfer object} si trovano a essere collocate in package diversi da \texttt{server.dao}, dal momento che si è ritenuto sensato inserirle in contesti maggiormente specializzati.Ad esempio, la classe corrispondente ai messaggi in segreteria verrà ad essere collocata in \texttt{server.message}, quella corrispondente alle chiamate in \texttt{server.call}, e così via.

\item{\scshape\bfseries Diagramma delle classi:}
\begin{figure}[H]
  \centering
  \includegraphics[width=.9\textwidth]{class_gestione_database}
  \caption{Diagramma delle classi - Gestione database}\label{fig:gestionedatabase}
\end{figure}

	\item{\scshape\bfseries Classi utilizzate:}
	\begin{itemize}[nolistsep, noitemsep]
	  \item[-] \texttt{dao.CallDAO}
	  \item[-] \texttt{dao.GroupDAO}
	  \item[-] \texttt{dao.MessageDAO}
	  \item[-] \texttt{dao.UserDataDAO}
	  \item[-] \texttt{dao.AddressBookEntryDAO}
	  \item[-] \texttt{dao.HibernateUtil}
	\end{itemize}
\end{description}

\subsubsection{CS02 -- Gestione connessione}\label{sec:cs02}
\begin{description}
	\item{\scshape\bfseries Descrizione:}\\
Tale componente ingloba le classi destinate a stabilire le \inglese{routine} di connessione fra il server e i client del sistema, necessarie in un secondo momento a gestire le chiamate in ingresso e in uscita dai client.

La comunicazione bidirezionale fra il server e i client è ottenuta estendendo la classe fornita dalle librerie di TomCat \texttt{org.apache.catalina.websocket.MessageInbound} mediante \texttt{connection.PushInbound}. In particolare sarà realizzato l'\inglese{overriding} del metodo \texttt{onTextMessage(CharBuffer)} in modo da permettere al componente \textsf{Gestione connessione} del server di reagire correttamente ai messaggi provenienti dal client in forma testuale.

Un ruolo essenziale è inoltre svolto dalla \inglese{servlet} \texttt{connection.ConnectionManager}, realizzata estendendo mediante ereditarietà la classe fornita dalle librerie di Apache TomCat \texttt{org.apache.catalina.websocket.WebSocketServlet}.

La caratteristica fondamentale della \inglese{servlet}, che rappresenta inoltre un punto di accesso centralizzato alle funzionalità del componente \textsf{Gestione connessione}, è quella di fare \inglese{overriding} del metodo \texttt{createWebSocketInbound(String, HttpServletRequest)} al fine di restituire un opportuno sottotipo di \texttt{org.apache.catalina.websocket.StreamInbound}. Il tipo dinamico dell'oggetto ritornato da \texttt{connection.ConnectionManager} corrisponde infatti proprio a \texttt{connection.PushInbound} in modo che lato client l'invocazione del costruttore di \texttt{WebSocket} (passando come parametro l'URL della \inglese{servlet}) provochi la creazione di una connessione del tipo voluto.

Ne consegue che, come sarà esposto con maggiori dettagli nella sezione \vref{sec:patternfactorymethod}, \texttt{createWebSocketInbound} è un'applicazione del \inglese{design pattern} Factory Method, in quanto la sottoclasse di \texttt{WebSocketServlet} restituisce un oggetto di tipo statico \texttt{StreamInbound} ma avente il tipo dinamico adatto agli scopi dell'applicazione.

	\item{\scshape\bfseries Diagramma delle classi:}
\begin{figure}[H]
  \centering
  \includegraphics[width=.8\textwidth]{class_gestione_connessione}
  \caption{Diagramma delle classi - Gestione connessione}\label{fig:gestioneconnessione}
\end{figure}
	
	\item{\scshape\bfseries Classi utilizzate:}
	\begin{itemize}[nolistsep, noitemsep]
	  \item[-] \texttt{connection.ConnectionManager}
	  \item[-] \texttt{connection.PushInbound}
	  \item[-] \texttt{org.apache.catalina.websocket.MessageInbound}
	  \item[-] \texttt{org.apache.catalina.websocket.WebSocketServlet}
	\end{itemize}
\end{description}

\subsubsection{CS03 -- Gestione rubrica}\label{sec:cs03}
\begin{description}
	\item{\scshape\bfseries Descrizione:}\\
A ogni utente del sistema, che corrisponde a un'istanza di \texttt{abook.UserData} (implementazione dell'interfaccia \texttt{abook.IUserData}) è associata una rubrica personale. 

ale rubrica è rappresentata da una lista di \texttt{abook.IAddressBookEntry}, per la quale si fornisce un'implementazione nominata \texttt{abook.AddressBookEntry} che rappresenta un contatto della rubrica di un utente. Come si evince dal diagramma riportato in figura \ref{fig:gestionerubrica}, la struttura del componente rispecchia la logica di funzionamento del database.

Di conseguenza, ogni istanza di tipo \texttt{abook.AddressBookEntry} apparterrà a un solo \texttt{abook.IUserData} e in essa è registrata un'istanza di \texttt{abook.UserData} che rappresenta il contatto facente parte della rubrica.

Gli utenti, inoltre, possono essere opzionalmente organizzati in gruppi: un contatto in rubrica può, in un dato momento, appartenere a uno o più gruppi oppure non appartenere a nessuno. Per tale motivo ogni istanza di \texttt{abook.AddressBookEntry} contiente anche un riferimento di tipo \texttt{IGroup}.

Tale interfaccia, congiuntamente alla sua implementazione \texttt{abookGroup}, permettono di rappresentare i gruppi della rubrica di un utente.

Infine, dal momento che gli utenti del sistema sono dotati di uno stato, è prevista la presenza di un'enumerazione \texttt{abook.State} con gli le istanze di \texttt{abook.UserData} sono composte.

In una prima realizzazione del prodotto si è scelto di implementare i seguenti stati:
\begin{itemize}
  \item \inglese{offline}, quando un utente è disconnesso;
  \item \inglese{online}/disponibile, cioè lo stato in cui si trova un utente in linea e disponibile ad accettare comunicazioni audio o audio/video in ingresso;
  \item \inglese{online}/occupato, quando un utente è in linea ma impegnato in una conversazione oppure ha impostato il proprio stato a non disponibile.
\end{itemize}

Infine, sono state predisposte tre \inglese{servlet} per fornire ai client l'accesso alle funzionalità di questo componente, in particolare \texttt{abook.AccountManager}, \texttt{abook.AddressBookManager} e \texttt{abook.StateManager}, che saranno descritte con maggiori dettagli nella sezione \vref{sec:cs07}.

	\item{\scshape\bfseries Diagramma delle classi:}
\begin{figure}[H]
  \centering
  \includegraphics[width=.7\textwidth]{class_gestione_rubrica}
  \caption{Diagramma delle classi - Gestione rubrica}\label{fig:gestionerubrica}
\end{figure}
	
	\item{\scshape\bfseries Classi utilizzate:}\\
	\begin{itemize}[nolistsep, noitemsep]
	  \item[-] \texttt{abook.AddressBookEntry}
	  \item[-] \texttt{abook.IAddressBookEntry}
	  \item[-] \texttt{abook.IGroup}
	  \item[-] \texttt{abook.Group}
	  \item[-] \texttt{abook.IUserData}
	  \item[-] \texttt{abook.UserData}
	  \item[-] \texttt{abook.State}
	  \item[-] \texttt{abook.AccountManager}
	  \item[-] \texttt{abook.AddressBookManager}
	  \item[-] \texttt{abook.StateManager}
	\end{itemize}
\end{description}

\subsubsection{CS04 -- Gestione autenticazione}\label{sec:cs04}
\begin{description}
  \item{\scshape\bfseries Descrizione:}\\
L'autenticazione passa attraverso due fasi: la richiesta di \inglese{login} e l'approvazione (\inglese{commit}). La richiesta di \inglese{login} verifica le credenziali di accesso con i dati memorizzati all'interno del database, mentre la richiesta di \inglese{commit} assegna, al \inglese{subject} che ha attivato al procedura di autenticazione, dei valori identificativi che permettano di identificarlo finché esso utilizza il sistema software.

Quando un utente avvia la procedura di autenticazione la \inglese{servlet} crea il contesto istanziando
\texttt{authentication.CredentialLoader} che ha il compito di caricare le credenziali di accesso e accede al file di configurazione per istanziare il giusto modulo per l'autenticazione, costituito dalla classe \texttt{authentication.AuthenticationModule}.
  
  \item{\scshape\bfseries Diagramma delle classi:}
  
  \item{\scshape\bfseries Classi utilizzate}
  \begin{itemize}
    	\item[-] \texttt{authentication.AuthenticationModule}
	  	\item[-] \texttt{authentication.CredentialLoader}
	 	\item[-] \texttt{authentication.PrincipalImpl}
	 	\item[-] \texttt{authentication.AuthenticationData}
	  	\item[-] \texttt{javax.security.auth.spi.LoginModule}
	  	\item[-] \texttt{javax.security.auth.callback.CallbackHandler}
	  	\item[-] \texttt{javax.security.Principal}
  \end{itemize}

\end{description}

\subsubsection{CS05 -- Gestione segreteria}\label{sec:cs05}
\begin{description}
	\item{\scshape\bfseries Descrizione:}\\
I messaggi in segreteria, che possono essere di natura audio o audio/video, corrispondono alle istanze dalla classe \texttt{message.Message} e sono caratterizzati da un utente mittente, da un destinatario e dalla data di registrazione.

La collezione di messaggi aventi un determinato utente come destinatario può essere ottenuta tramite un'operazione dichiarata nell'interfaccia \texttt{abook.IUserData}.

Per consentire ai client di accedere alle funzionalità gestite da questo componente è stata predisposta la \inglese{servlet} \texttt{MessageManager}, che sarà descritta con maggiori dettagli nella sezione \vref{sec:cs07}.

	\item{\scshape\bfseries Diagramma delle classi:}
\begin{figure}[H]
  \centering
  \includegraphics[width=.8\textwidth]{class_gestione_segreteria}
  \caption{Diagramma delle classi - Gestione segreteria}\label{fig:gestionesegreteria}
\end{figure}	
	
	\item{\scshape\bfseries Classi utilizzate:}
	\begin{itemize}[noitemsep,nolistsep]
	  \item[-] \texttt{abook.IUserData}
		\item[-] \texttt{message.IMessage}
	  \item[-] \texttt{message.Message}
	  \item[-] \texttt{message.MessageManager}
	\end{itemize}
\end{description}

\subsubsection{CS06 -- Gestione chiamate}\label{sec:cs06}
\begin{description}
  \item{\scshape\bfseries Descrizione:}\\
Le classi di questo componente hanno il ruolo di incapsulare la logica di gestione delle chiamate e di accesso ai dati relativi a una chiamata (data, mittente e $n\geq1$ destinatari della chiamata). Tali informazioni rivestono un ruolo importante per la rappresentazione e la trasmissione ai client dello storico delle chiamate.

La componente contiene l'interfaccia \texttt{ICall} e la sua implementazione lato server \texttt{Call}, che rappresenta il \inglese{transfer object} per la rappresentazione delle chiamate che deve essere mappata nel database.

Infine, allo scopo di consentire ai client di accedere alle funzionalità di questo componente, è prevista la presenza della \inglese{servlet} \texttt{call.CallHistoryManager}, il cui ruolo sarà descritto con maggiori dettagli nella sezione \vref{sec:cs07}.

  \item{\scshape\bfseries Diagramma delle classi:}
\begin{figure}[H]
  \centering
  \includegraphics[width=.6\textwidth]{class_gestione_chiamate}
  \caption{Diagramma delle classi - Gestione chiamate}\label{fig:gestionechiamate}
\end{figure}

  \item{\scshape\bfseries Classi utilizzate:}\\
  \begin{itemize}[noitemsep,nolistsep]
    \item[-] \texttt{call.ICall}
    \item[-] \texttt{call.Call}
    \item[-] \texttt{call.CallHistoryManager}
  \end{itemize}
\end{description}

\subsubsection{CS07 -- Façade del server}\label{sec:cs07}
\begin{description}
	\item{\scshape\bfseries Descrizione:}\\
Tale componente ha il ruolo di offrire ai client una serie di punti di accesso alle funzionalità del sistema server. Dal momento che tale interazione avviene in un contesto distribuito, i punti di accesso ai componenti del server sono stati implementati come \inglese{servlet} Java destinate a essere eseguite nell'ambiente del \inglese{servlet container} fornito da Apache TomCat.

Per questo motivo, tali Façade saranno realizzate come estensioni della classe di libreria \texttt{javax.servlet.http.HttpServlet}, al fine di creare un sistema di risposta lato server che prenderà in carico le richieste provenienti dai client.

La classe Java \texttt{HttpServlet} implementa un sistema di \inglese{listening} che permette di monitorare costantemente richieste in ingresso. Queste ultime possono essere di duplice natura e corrispondono ai metodi di invio dei dati previsti dal protocollo HTTP (\texttt{GET} e \texttt{POST}).

La mappatura fra componenti del server e le rispettive \inglese{servlet} di Façade, implementate come sottoclassi di \texttt{javax.servlet.http.HttpServlet} è illustrata dalla tabella seguente:
\begin{center}
\rowcolors{2}{lightblue}{llightblue}
\begin{tabular}{>{\sffamily}l>{\ttfamily}p{.6\textwidth}}
\toprule
\textbf{\rmfamily Componente} & \textbf{\rmfamily Servlet di Façade}\\
\midrule
CS02 -- Gestione connessione & connection.ConnectionManager\\
CS03 -- Gestione rubrica & abook.AddressBookManager abook.AccountManager abook.StateManager\\
CS04 -- Gestione autenticazione & authentication.LoginManager\\
CS05 -- Gestione segreteria & message.MessageManager\\
CS06 -- Gestione chiamate & call.CallHistoryManager\\
\bottomrule
\end{tabular}
\end{center}

In particolare \texttt{connection.ConnectionManager} è coinvolto dopo la fase di \inglese{login}, una volta che è stata accertata la validità dell'autenticazione, e interagisce con \textsf{Gestione connessione} allo scopo di creare un canale di comunicazione fra il server e il client, secondo le modalità illustrate nella sezione \ref{sec:cs02}.\footnote{%
Tale classe, come anticipato nella descrizione a pagina \pageref{sec:cs02}, non è in realtà sottotipo diretto di \texttt{javax.servlet.http.HttpServlet}, ma estende \texttt{org.apache.catalina.websocket.WebSocketServlet} che a sua volta è sottoclasse di \texttt{javax.servlet.http.HttpServlet}.
}

Il compito di interfacciarsi con \textsf{Gestione rubrica} per recuperare la rubrica associata ad un utente e per riflettere sul server le operazioni di amministrazione della rubrica spetta invece a \texttt{abook.AddressBookManager}, mentre \texttt{abook.AccountManager} risponde alle richieste dei client per le azioni di aggiornamento e modifica dell'account personale dell'utente associato al client.

I cambiamenti di stato di un utente sono invece processati da \texttt{abook.StateManager} che fornisce di conseguenza anch'esso un punto d'accesso al componente \textsf{Gestione rubrica}.

Ai fini del \inglese{login} è utilizzata invece la \inglese{servlet} \texttt{authentication.LoginManager}, che ha il compito di interfacciarsi con il sistema di autenticazione e, in particolare, con l'istanza del sottotipo di \texttt{javax.security.auth.spi.LoginModule} in uso per verificare le credenziali.

Infine, lo scaricamento e la gestione della segreteria telefonica (di competenza di \textsf{Gestione segreteria}) e dello storico delle chiamate (per quanto riguarda il componente \textsf{Gestione chiamate}) avvengono in risposta alle richieste dei client pervenute a \texttt{message.MessageManager} e \texttt{call.CallHistoryManager} rispettivamente.

Il fatto che siano presenti sette \inglese{servlet} a fronte di cinque compoenti di cui il server espone le funzionalità verso i client è riconducibile a due ordini di ragioni.

Da una parte, non è prevista la presenza di alcun punto d'accesso diretto dai client a \textsf{Gestione database}, dal momento che le informazioni contenute in quest'ultimo sono manipolate dalle classi DAO a loro volta utilizzate dagli altri Façade.

Dall'altra i dati rappresentati in \textsf{Gestione rubrica} necessitano di essere trattati in maniera radicalmente differente a seconda che si tratti di informazioni relative all'utente associato al client da cui proviene la richiesta al server (tramite \texttt{abook.AccountManager}) o a un semplice contatto della rubrica di quest'ultimo (tramite \texttt{abook.AddressBookManager}), mentre le richieste relative ai cambiamenti di stato sono gestite da \texttt{abook.StateManager}. Ciò giustifica la presenza di tre distinte \inglese{servlet} di Façade.

	\item{\scshape\bfseries Diagramma delle classi:}
\begin{figure}[H]
  \centering
  \includegraphics[width=.7\textwidth]{class_facade_server}
  \caption{Diagramma delle classi - Façade del server}\label{fig:facadeserver}
\end{figure}	
	
	\item{\scshape\bfseries Classi utilizzate:}\\
	\begin{itemize}[noitemsep,nolistsep]
	  \item[-] \texttt{abook.AccountManager}
	  \item[-] \texttt{abook.AddressBookManager}
	  \item[-] \texttt{abook.StateManager}
	  \item[-] \texttt{call.CallHistoryManager}
	  \item[-] \texttt{connection.ConnectionManager}
	  \item[-] \texttt{message.MessageManager}
    \item[-] \texttt{authentication.LoginManager}
	  \item[-] \texttt{javax.servlet.http.HttpServlet}
	  \item[-] \texttt{org.apache.catalina.websocket.WebSocketServlet}
	\end{itemize}
\end{description}

\subsection{Descrizione delle classi}

\subsubsection{Package \texttt{org.softwaresynthesis.mytalk.server.dao}}

\begin{itemize}[leftmargin=0em]

\item \texttt{CallDAO}
\begin{description}
  \item{\scshape\bfseries Descrizione:}\\

Tale classe interagisce con il \inglese{framework} Hibernate e contiene la logica per la manipolazione dei dati (in lettura e scrittura) nella tabella Call del database.

  \item{\scshape\bfseries Componenti che ne fanno uso:}
  \begin{itemize}[noitemsep,nolistsep]
    \item[-] \textsf{CS01 -- Gestione database}
    \item[-] \textsf{CS07-- Façade del server}
  \end{itemize}
\end{description}

\item \texttt{MessageDAO}
\begin{description}
  \item{\scshape\bfseries Descrizione:}\\

Tale classe interagisce con il \inglese{framework} Hibernate e contiene la logica per la manipolazione dei dati (in lettura e scrittura) nella tabella Message del database.

  \item{\scshape\bfseries Componenti che ne fanno uso:}
  \begin{itemize}[noitemsep,nolistsep]
    \item[-] \textsf{CS01 -- Gestione database}
    \item[-] \textsf{CS07-- Façade del server}
  \end{itemize}
\end{description}

\item \texttt{GroupDAO}
\begin{description}
  \item{\scshape\bfseries Descrizione:}\\

Tale classe interagisce con il \inglese{framework} Hibernate e contiene la logica per la manipolazione dei dati (in lettura e scrittura) nella tabella Group del database.

  \item{\scshape\bfseries Componenti che ne fanno uso:}
  \begin{itemize}[noitemsep,nolistsep]
    \item[-] \textsf{CS01 -- Gestione database}
    \item[-] \textsf{CS07-- Façade del server}
  \end{itemize}
\end{description}

\item \texttt{UserDataDAO}
\begin{description}
  \item{\scshape\bfseries Descrizione:}\\

Tale classe interagisce con il \inglese{framework} Hibernate e contiene la logica per la manipolazione dei dati (in lettura e scrittura) nella tabella UserData del database.

  \item{\scshape\bfseries Componenti che ne fanno uso:}
  \begin{itemize}[noitemsep,nolistsep]
    \item[-] \textsf{CS01 -- Gestione database}
    \item[-] \textsf{CS07-- Façade del server}
  \end{itemize}
\end{description}

\item \texttt{AddresBookEntryDAO}
\begin{description}
  \item{\scshape\bfseries Descrizione:}\\

Tale classe interagisce con il \inglese{framework} Hibernate e contiene la logica per la manipolazione dei dati (in lettura e scrittura) nella tabella AddressBookEntries del database.

  \item{\scshape\bfseries Componenti che ne fanno uso:}
  \begin{itemize}[noitemsep,nolistsep]
    \item[-] \textsf{CS01 -- Gestione database}
    \item[-] \textsf{CS07-- Façade del server}
  \end{itemize}
\end{description}

\item \texttt{HibernateUtil}
\begin{description}
  \item{\scshape\bfseries Descrizione:}\\
Classe che implementa il \inglese{pattern} Singleton e che viene utilizzata dalle classi DAO al fine di ottenere un riferimento alla sessione di connessione al DBMS tramite la quale effettuare le transazioni corrispondenti alle operazioni volte ad assicurare la persistenza dei dati.

  \item{\scshape\bfseries Componenti che ne fanno uso:}
  \begin{itemize}[noitemsep,nolistsep]
    \item[-] \textsf{CS01 -- Gestione database}
  \end{itemize}
\end{description}

\end{itemize}

\subsubsection{Package \texttt{org.softwaresynthesis.mytalk.server.connection}}

\begin{itemize}[leftmargin=0em]

\item \texttt{PushInbound}
\begin{description}
  \item{\scshape\bfseries Descrizione:}\\
Sottoclasse di \texttt{org.apache.catalina.websocket.MessageInbound} (e, di conseguenza sottotipo anche di \texttt{org.apache.catalina.websocket.StreamInbound}) che rappresenta il canale di comunicazione bidirezionale fra client e server realizzato mediante WebSocket.

Il comportamento della sotto-architettura server in risposta ai messaggi ricevuti dal client è completamente determinato dall'implementazione (\inglese{overriding}) che tale classe fornisce del metodo \texttt{void onTextMessage(CharBuffer)}.

  \item{\scshape\bfseries Componenti che ne fanno uso:}
  \begin{itemize}[noitemsep,nolistsep]
    \item[-] \textsf{CS02 -- Gestione connessione}
    \item[-] \textsf{CS07-- Façade del server}
  \end{itemize}
\end{description}

\item \texttt{ConnectionManager}
\begin{description}
	\item{\scshape\bfseries Descrizione:}\\
Sottoclasse di \texttt{org.apache.catalina.websocket.WebSocketServlet} che ha la funzione di punto di accesso al componente \textsf{Gestione connessione} grazie al quale, ad autenticazione avvenuta, viene instaurato un canale di comunicazione fra il server e il client, destinato a essere usato per effettuare e ricevere le comunicazioni fra client.

Come accennato nella sezione \vref{sec:cs02}, tramite un opportuno \inglese{overriding} del metodo \texttt{createWebSocketInbound(String, HttpServletRequest}, la \inglese{servlet} restituisce ai client un canale di comunicazione che, per la sua natura \inglese{full-duplex}, può essere utilizzato sia dal client per trasmettere messaggi al server che viceversa.

Questo Factory Method (per la cui descrizione si rimanda alla sezione \ref{sec:patternfactorymethod}) è richiamato dal \inglese{servlet container} nel momento in cui lato client, ad autenticazione ultimata, viene invocato il costruttore di \texttt{WebSocket} passando a quest'ultimo come parametro l'URL della \inglese{servlet} \texttt{ConnectionManager}.

	\item{\scshape\bfseries Componenti che ne fanno uso:}
	\begin{itemize}[noitemsep,nolistsep]
	  \item[-] \textsf{CS02 -- Gestione connessione}
	  \item[-] \textsf{CS07-- Façade del server}
	\end{itemize}
\end{description}

\end{itemize}

\subsubsection{Package \texttt{org.softwaresynthesis.mytalk.server.abook}}

\begin{itemize}[leftmargin=0em]

\item \texttt{IAddressBookEntry}
\begin{description}
	\item{\scshape\bfseries Descrizione:}\\
Interfaccia che raccoglie le operazioni per la gestione di un utente appartenente alla rubrica di un altro utente (metodi \inglese{get}/\inglese{set} per accedere ai dati del contatto).

	\item{\scshape\bfseries Componenti che ne fanno uso:}
	\begin{itemize}[noitemsep,nolistsep]
	  \item[-] \textsf{CS03 -- Gestione rubrica}
      \item[-] \textsf{CS07-- Façade del server}
	\end{itemize}
\end{description}

\item \texttt{AddressBookEntry}
\begin{description}
	\item{\scshape\bfseries Descrizione:}\\
Classe che implementa l'interfaccia \texttt{IAddressBookEntry} e rappresenta quindi un contatto della rubrica associata a un determinato utente.

Permette di accedere al contatto di cui si compone, al suo gruppo e di determinare se tale utente risulta essere bloccato dall'utente possessore del contatto.

	\item{\scshape\bfseries Componenti che ne fanno uso:}
	\begin{itemize}[noitemsep,nolistsep]
	  \item[-] \textsf{CS03 -- Gestione rubrica}
	\end{itemize}
\end{description}

\item \texttt{IUserData}
\begin{description}
	\item{\scshape\bfseries Descrizione:}\\
Interfaccia per le classi che rappresentano gli utenti, è dotata di operazioni \inglese{get}/\inglese{set} per accedere ai dati degli utenti registrati sul sistema.

	\item{\scshape\bfseries Componenti che ne fanno uso:}
	\begin{itemize}[noitemsep,nolistsep]
	  \item[-] \textsf{CS03 -- Gestione rubrica}
	  \item[-] \textsf{CS07 -- Façade del server}
	\end{itemize}
\end{description}

\item \texttt{UserData}
\begin{description}
	\item{\scshape\bfseries Descrizione:}\\
Classe \inglese{transfer object} che implementa l'interfaccia \texttt{IUserData} le cui istanze corrispondono ai record della tabella degli utenti nel database.

È caratterizzata dai campi dati che corrispondono alle proprietà degli utenti (email, password, domanda segreta e relativa risposta, nome, cognome e immagine personale).

	\item{\scshape\bfseries Componenti che ne fanno uso:}
	\begin{itemize}[noitemsep,nolistsep]
	  \item[-] \textsf{CS03 -- Gestione rubrica}
	\end{itemize}
\end{description}

\item \texttt{IGroup}
\begin{description}
	\item{\scshape\bfseries Descrizione:}\\
Interfaccia per i gruppi interni alla rubrica di un utente, prevede un'operazione astratta \texttt{add(IUserData)} per l'aggiunta di un nuovo contatto al gruppo e \texttt{remove(IUserData)} per la sua rimozione di un contatto dal gruppo. Contiene anche i metodi \inglese{get}/\inglese{set} per impostare o recuperare il nome di un gruppo.

	\item{\scshape\bfseries Componenti che ne fanno uso:} 
	  \begin{itemize}[noitemsep,nolistsep]
	    \item[-] \textsf{CS03 -- Gestione rubrica}
	    \item[-] \textsf{CS07-- Façade del server}
	  \end{itemize}
\end{description}

\item \texttt{Group}
\begin{description}
	\item{\scshape\bfseries Descrizione:}\\
Implementazione dell'interfaccia \texttt{IGroup}, che costituisce anche il \inglese{transfer object} per i gruppi di una rubrica utente. Ogni gruppo è dotato di un nome e raccoglie in sé uno o più istanze di classi sottotipo di \texttt{abook.IUserData}.

	\item{\scshape\bfseries Componenti che ne fanno uso:}
	  \begin{itemize}[noitemsep,nolistsep]
	    \item[-] \textsf{CS03 -- Gestione rubrica}
	  \end{itemize}
\end{description}

\item \texttt{State}
\begin{description}
  \item{\scshape\bfseries Descrizione:}\\
Classe che attraverso un tipo enumerativo rappresenta lo stato in cui si trova un'istanza di un sottotipo di \texttt{abook.IUserData}.

Le istanze della classe \texttt{abook.UserData} sono composte con un'istanza di \texttt{abook.State} che rappresenta lo stato in cui si trova un determinato utente in un determinato momento.
  
  \item{\scshape\bfseries Componenti che ne fanno uso:}
  \begin{itemize}
    \item[-] \textsf{CS02 -- Gestione rubrica}
    \item[-] \textsf{CS07-- Façade del server}
   \end{itemize}
\end{description}

\item \texttt{AddressBookManager}
\begin{description}
	\item{\scshape\bfseries Descrizione:}\\
Sottoclasse di \texttt{javax.servlet.http.HttpServlet} che ha il compito di fornire ai client un'interfaccia per la consultazione e la gestione della rubrica.

Rispondendo alle richieste dei client, infatti, consente lo scaricamento della rubrica restituendo i contatti in una forma serializzata adatta allo scambio di dati.

Inoltre, questa \inglese{servlet} è in grado di recepire le richieste di modifica sui dati della rubrica di un utente che corrispondono ai RUFF$4.x$, quali l'inserimento o la cancellazione di un contatto, creazione o eliminazione di gruppi, rimozione o aggiunta di un elemento da un gruppo.

	\item{\scshape\bfseries Componenti che ne fanno uso:}
	\begin{itemize}[noitemsep,nolistsep]
	  \item[-] \textsf{CS07-- Façade del server}
	  \item[-] \textsf{CP03 -- Gestione GUI}
	\end{itemize}
\end{description}

\item \texttt{AccountManager}
\begin{description}
	\item{\scshape\bfseries Descrizione:}\\
Sottoclasse di \texttt{javax.servlet.http.HttpServlet} mediante la quale è possibile amministrare i propri dati personali memorizzati sul server, in accordo con i RUFF3.1.0 e RUFF3.2.0. Le richieste provenienti dai client comportano pertanto la modifica dei dati di autenticazione e dei dati anagrafici facoltativi.

	\item{\scshape\bfseries Componenti che ne fanno uso:}
	\begin{itemize}[noitemsep,nolistsep]
	  \item[-] \textsf{CS07-- Façade del server}
	  \item[-] \textsf{CP03 -- Gestione GUI}
	\end{itemize}
\end{description}

\item \texttt{StateManager}
\begin{description}
	\item{\scshape\bfseries Descrizione:}\\
Sottoclasse di \texttt{javax.servlet.http.HttpServlet} avente la funzione di recepire le richieste corrispondenti ai cambiamenti di stato dei client del sistema.

I cambiamenti di stato hanno origine nel client sia per esplicito intervento dell'utente (ad es. una disconnessione o un passaggio da disponibile a ``occupato'') sia implicitamente, ad esempio alla ricezione di una comunicazione audio o audio/video.

	\item{\scshape\bfseries Componenti che ne fanno uso:}
	\begin{itemize}[noitemsep,nolistsep]
	  \item[-] \textsf{CS07-- Façade del server}
	  \item[-] \textsf{CP03 -- Gestione GUI}
	\end{itemize}
\end{description}

\end{itemize}

\subsubsection{Package \texttt{org.softwaresynthesis.mytalk.server.message}}

\begin{itemize}[leftmargin=0pt]

\item \texttt{IMessage}
\begin{description}
  \item{\scshape\bfseries Descrizione:}\\
Interfaccia che dichiara le operazioni astratte (\inglese{get}/\inglese{set}) necessarie ad accedere alle proprietà di un messaggio in segreteria (in particolare: mittente, destinatario, stato del messaggio e data di registrazione).

  \item{\scshape\bfseries Componenti che ne fanno uso:}
  \begin{itemize}[noitemsep,nolistsep]
    \item[-] \textsf{CS05 -- Gestione segreteria}
	\item[-] \textsf{CS07-- Façade del server}
  \end{itemize}
\end{description}

\item \texttt{Message}
\begin{description}
	\item{\scshape\bfseries Descrizione:}\\
Classe \inglese{transfer object} che rappresenta un messaggio di natura audio o audio/video nella segreteria telefonica di un utente e implementa l'interfaccia \texttt{IMessage}.

	\item{\scshape\bfseries Componenti che ne fanno uso:}
	  \begin{itemize}[noitemsep,nolistsep]
	    \item[-] \textsf{CS05 -- Gestione segreteria}
	  \end{itemize}
\end{description}

\item \texttt{MessageManager}
\begin{description}
	\item{\scshape\bfseries Descrizione:}\\
Sottoclasse di \texttt{javax.servlet.http.HttpServlet} che rappresenta il punto di accesso al componente \textsf{Gestione segreteria} e consente pertanto ai client di interrogare il server sullo stato della segreteria associata a un determinato utente.

Oltre allo scaricamento dei messaggi in forma serializzata, le richieste provenienti dai client prevedono la cancellazione di un messaggio dalla segreteria (RUFF15.4.0) oppure l'impostazione dello stato del messaggio (RUFF15.5.0).

	\item{\scshape\bfseries Componenti che ne fanno uso:}
	\begin{itemize}[noitemsep,nolistsep]
	  \item[-] \textsf{CS07-- Façade del server}
	  \item[-] \textsf{CP03 -- Gestione GUI}
	\end{itemize}
\end{description}

\end{itemize}

\subsubsection{Package \texttt{org.softwaresynthesis.mytalk.server.call}}

\begin{itemize}[noitemsep,nolistsep]

\item \texttt{ICall}
\begin{description}
  \item{\scshape\bfseries Descrizione:}\\
Interfaccia che contiene le operazioni astratte di accesso ai dati (metodi \inglese{get}/\inglese{set}) che caratterizzano le chiamate, vale a dire il chiamante, l'insieme degli utenti chiamati nonché la data e l'ora di avvio e di terminazione della chiamata.
  \item{\scshape\bfseries Componenti che ne fanno uso:}
  \begin{itemize}[noitemsep,nolistsep]
    \item[-] \textsf{CS06 -- Gestione chiamate}
	\item[-] \textsf{CS07-- Façade del server}
  \end{itemize}
\end{description}

\item \texttt{Call}
\begin{description}
  \item{\scshape\bfseries Descrizione:}\\
Classe \inglese{transfer object} che rappresenta le chiamate realizzate attraverso il sistema e implementa l'interfaccia \texttt{ICall}.
  \item{\scshape\bfseries Componenti che ne fanno uso:}
  \begin{itemize}[noitemsep,nolistsep]
    \item[-] \textsf{CS06 -- Gestione chiamate}
  \end{itemize}
\end{description}

\item \texttt{CallHistoryManager}
\begin{description}
	\item{\scshape\bfseries Descrizione:}\\
Sottoclasse di \texttt{javax.servlet.http.HttpServlet} la cui responsabilità è intercettare le richieste aventi come oggetto lo storico delle chiamate utente, che deve essere restituito dal server al client in forma opportunamente serializzata per l'interscambio di dati. Non è previsto invece alcun tipo di operazione ``attiva'' sui dati memorizzati nel server.

	\item{\scshape\bfseries Componenti che ne fanno uso:}
	\begin{itemize}[noitemsep,nolistsep]
	  \item[-] \textsf{CS07-- Façade del server}
	  \item[-] \textsf{CP03 -- Gestione GUI}
	\end{itemize}
\end{description}

\end{itemize}

%TODO queste sono tutte da descrivere
\subsubsection{Package \texttt{org.softwaresynthesis.mytalk.authentication}}

\begin{itemize}[noitemsep,nolistsep]

\item \texttt{AuthenticationModule}
\begin{description}
  \item{\scshape\bfseries Descrizione}\\
  	Implementazione dell'interfaccia \texttt{javax.security.auth.spi.LoginModule} definisce la logica di autenticazione attuata dal sistema mytalk. Se si avesse bisogno di una maggiore sicurezza per questa procedura è sufficiente fornire una nuova implementazione di questa interfaccia.
  \item{\scshape\bfseries Componenti che ne fanno uso}
  \begin{itemize}[noitemsep,nolistsep]
    \item[-] \textsf{CS04 -- Gestione autenticazione}
    \item[-] \textsf{CS07-- Façade del server}
  \end{itemize}
\end{description}

\item \texttt{CredentialLoader}
\begin{description}
  \item{\scshape\bfseries Descrizione}\\
  	La classe ha compito di caricare le credenziali di accesso, fornite dall'utente, con lo scopo di metterle a disposizione del modulo di autenticazione \texttt{AuthenticationModule}.
  \item{\scshape\bfseries Componenti che ne fanno uso}
  \begin{itemize}[noitemsep,nolistsep]
    \item[-] \textsf{CS04 -- Gestione autenticazione}
    \item[-] \textsf{CS07 -- Façade del server}
  \end{itemize}
\end{description}

\item \texttt{PrincipalImpl}
\begin{description}
  \item{\scshape\bfseries Descrizione}\\
  	La classe serve per contenere un elemento identificativo dell'utente che ha effettuato l'autenticazione, in modo che possa essere facilmente identificato nelle altre componenti del software.  
  \item{\scshape\bfseries Componenti che ne fanno uso}
  \begin{itemize}[noitemsep,nolistsep]
    \item[-] \textsf{CS04 -- Gestione autenticazione}
    \item[-] \textsf{CS07 -- Façade del server}
  \end{itemize}
\end{description}

\item \texttt{AuthenticationData}
\begin{description}
	\item{\scshape\bfseries Descrizione}\\
		La classe contiene le credenziali di accesso, fornite dall'utente, ed utilizzate da \texttt{CredentialLoader}.
	\item{\scshape\bfseries Componenti che ne fanno uso}
		\begin{itemize}[noitemsep],nolistsep]
			\item[-] \textsf{CS04 -- Gestione autenticazione}
			\item[-] \textsf{CS07 -- Façade del server}
		\end{itemize}
\end{description}

\item \texttt{LoginManager}
\begin{description}
  \item{\scshape\bfseries Descrizione}\\
  Ha il compito di creare il corretto modulo di autenticazione, \texttt{AuthenticationModule}, dal file di configurazione e il corretto caricatore di credenziali, \texttt{CredentialLoader}. Dopo questa inizializzazione avvia la procedura di autenticazione.
  \item{\scshape\bfseries Componenti che ne fanno uso}
  \begin{itemize}[noitemsep,nolistsep]
    \item[-] \textsf{CS04 -- Gestione autenticazione}
    \item[-] \textsf{CS07 -- Façade del server}
    %TODO a questa servlet accede anche qualche componente del presenter
  \end{itemize}
\end{description}

\end{itemize}

\begin{figure}[H]
  \centering
  \includegraphics[width=1\textwidth]{server_generale}
  \caption{Diagramma delle classi - Architettura \texttt{mytalk.server}}\label{fig:sottoarchserver}
\end{figure}
\clearpage

\section{Architettura \texttt{mytalk.clientpresenter}}\label{sec:clientpresenter}
La sotto-architettura \texttt{clientpresenter}, nasce con lo scopo di imporre una separazione tra la logica di gestione di un client e l'interfaccia grafica visualizzata all'utente finale.

Dal momento che il \inglese{presenter} ha la responsabilità di ricevere i comandi utente dalla vista e di sovrintendere all'aggiornamento della stessa, è prevista anche la presenza di una serie di oggetti necessari a gestire l'interazione con la vista, corrispondenti al componente \textsf{Gestione GUI}\@.

Dal momento che per l'interazione con l'utente sono previste molteplici viste, è stato predisposto un \inglese{presenter} per ognuna di queste. Ogni vista detiene un riferimento al proprio \inglese{presenter} cui vengono inviate le richieste su risposta dell'interazione con l'utente, in quanto le operazioni del \inglese{presenter} sono impostate come funzioni di \inglese{callback} nell'interfaccia grafica.

D'altro canto, i vari \inglese{presenter} interagiscono con le viste grazie alla conoscenza di una ``interfaccia'' per la loro manipolazione, in quanto tramite JavaScript è possibile intervenire sul \underline{DOM}\@. Tali considerazioni sono conformi all'utilizzo del \inglese{design pattern} MVP.\footnote{%
  Per una descrizione più dettagliata del \inglese{pattern} MVP si rimanda alla sezione \ref{sec:MVP}\@.
}

Questo componente ha inoltre il compito di recuperare i dati presenti sul server relativi alla rubrica di un utente, la sua segreteria telefonica e lo storico delle chiamate che lo interessano. I diversi \inglese{presenter} del componente \textsf{Gestione GUI} hanno dunque anche il compito di interrogare il server al fin di procurarsi le informazioni con cui popolare l'interfaccia grafica utente.

Questi sono rappresentati dalle strutture del componente \textsf{Rappresentazione dati} e permangono internamente al \inglese{presenter} per essere disponibili a successive interrogazioni da parte della GUI senza coinvolgere nuovamente il server.

Inoltre, allo scopo di gestire le comunicazioni in ingresso dal server inerenti alla gestione della segreteria o della rubrica (cambiamenti di stato degli utenti), è stato predisposto il componente \textsf{Gestione remota}.

La logica di comunicazione fra client è incapsulata all'interno delle classi facenti parte del componente \textsf{Gestione comunicazione}. Queste ultime sfruttano un canale di comunicazione bidirezionale client-server per interagire con il server in merito alle richieste di comunicazione con altri client, andando a creare appositi canali di comunicazione che si avvalgono della tecnologia WebRTC\@.

In sintesi, la sotto-architettura \texttt{clientpresenter} dispone dei seguenti componenti:
\begin{itemize}[noitemsep,nolistsep]
	\item[-] \textsf{CP01 -- Gestione comunicazione};
	\item[-] \textsf{CP02 -- Rappresentazione dati};
	\item[-] \textsf{CP03 -- Gestione GUI};
	\item[-] \textsf{CP04 -- Gestione remota};
\end{itemize}
che saranno descritte con maggiori dettagli nella sezione successiva.

Si ricorda sin da ora che i nomi di tutte le interfacce e tutte le classi riportate nella sezione sono implicitamente parte del package \texttt{org.softwaresynthesis.mytalk.clientpresenter} pertanto tale prefisso sarà omesso nella loro denominazione.

Nella progettazione ad alto livello è stato scelto di non tenere in considerazione il dominio tecnologico dell'applicativo, che non prevede la presenza di classi e interfacce. In questa sede, la progettazione sarà influenzata unicamente dalle specifiche e dai principi della programmazione orientata agli oggetti.

Tale scelta è motivata dalle seguenti considerazioni:
\begin{itemize}
   \item l'utilizzo dei \inglese{pattern} architetturali necessita a monte di uno stile di progettazione ad oggetti;
   \item così facendo è garantita la possibilità di riuso del risultato progettazione architetturale sotto altri domini tecnologici.
\end{itemize}

La presenza delle interfacce, delle relazioni di implementazione e l'estensione fra classi saranno pertanto mantenute.

\subsection{Componenti evidenziati}

%TODO da rivedere con Tres e Schivo!
\subsubsection{CP01 -- Gestione comunicazione}
\begin{description}
	\item{\scshape\bfseries Descrizione:}\\
È il componente che rappresenta il nucleo logico fondamentale della comunicazione. In esso è presente la classe Singleton \texttt{kernel.CommunicationCenter}, che detiene un oggetto di tipo \texttt{connection.IChannel} al fine di comunicare con il server, e che ha la responsabilità di tener traccia delle comunicazioni aperte con i client usando la tecnologia WebRTC\@.

Tali comunicazioni sono rappresentate dall'interfaccia \texttt{kernel.IClientCommunication} che rappresenta il contratto di un oggetto utilizzabile come canale di comunicazione client-client. L'implementazione di tale interfaccia che utilizzerà WebRTC prende il nome di \texttt{kernel.WebRTCCommunication}. Tale classe è istanziata da \texttt{kernel.CommunicationCenter} sulla base delle informazioni ottenute dall'istanza \texttt{connection.IChannel}. 

Nello specifico i due possibili iter sono:
\begin{description}
	\item{\bfseries\scshape Alla icezione di una chiamata} il server riceve una richiesta da parte di un client esterno per parlare con il client corrente.
	
Il server utilizza l'istanza di \texttt{connection.IChannel} creata in fase di autenticazione per processare la richiesta. L'istanza di \texttt{kernel.CommunicationCenter} presente sul client raccoglie le informazioni dal canale di comunicazione e le usa per istanziare un \texttt{kernel.WebRTCCommunication}.

Al termine della procedura, l'applicativo lato client potrà comunicare usando tale istanza.
	\item{\bfseries\scshape Nel caso dell'avvio di una chiamata}, il client corrente richiede di comunicare con un client esterno.
	
Il chiamante in questo caso ha la responsabilità di inoltrare la propria richiesta al server, mediante \texttt{connection.IChannel}.

Quindi, una volta ottenuta risposta, il chiamante è in grado di costruire l'oggetto \texttt{kernel.WebRTCCommunication} per parlare con il client esterno.
\end{description}

	\item{\scshape\bfseries Diagramma delle classi:}
  \begin{figure}[H]
    \centering
    \includegraphics[width=.7\textwidth]{class_gestione_comunicazione}
    \caption{Diagramma delle classi - Gestione comunicazione}\label{fig:gestionecomunicazione}
  \end{figure}

	\item{\scshape\bfseries Classi utilizzate:} 
	\begin{itemize}[noitemsep,nolistsep]
		\item[-] \texttt{kernel.CommunicationCenter}
		\item[-] \texttt{kernel.IClientCommunication}
		\item[-] \texttt{kernel.WebRTCCommunication}
		\item[-] \texttt{org.softwaresynthesis.mytalk.server.connection.IChannel}
	\end{itemize}  
\end{description}

\subsubsection{CP02 -- Rappresentazione dati}
\begin{description}
  \item{\scshape\bfseries Descrizione:}\\
Le classi di questo componente hanno il compito di rappresentare sotto forma di apposite strutture dati le informazioni ottenute dall'interrogazione del modello dei dati e ricevute in forma serializzata a seguito delle richieste al server.

La disponibilità di queste informazioni sul client permette una più agevole rappresentazione dell'interfaccia grafica per gli oggetti del componente \textsf{Gestione GUI} ed evita nuove interrogazioni al server qualora i dati in possesso da parte del \inglese{presenter} siano ancora validi.

I dati rappresentati in forma di oggetti sono necessari, in particolare, per la gestione della segreteria, dello storico delle chiamate e della rubrica lato client.

  \item{\scshape\bfseries Diagramma delle classi:}\\
  \begin{figure}[H]
    \centering
    \includegraphics[width=.8\textwidth]{class_rappresentazione_dati}
    \caption{Diagramma delle classi - Rappresentazione dati}\label{fig:rappresentazionedati}
  \end{figure}

	\item{\scshape\bfseries Classi utilizzate:} 
	\begin{itemize}[noitemsep,nolistsep]
		\item[-] \texttt{kernel.JSCall}
		\item[-] \texttt{kernel.JSMessage}
		\item[-] \texttt{kernel.JSUserData}
	\end{itemize}  
\end{description}

\subsubsection{CP03 -- Gestione GUI}
\begin{description}
	\item{\scshape\bfseries Descrizione:}\\
Il componente ha il duplice ruolo di intercettare gli eventi che scaturiscono dall'interazione dell'utente con la GUI e di controllare l'aggiornamento della stessa a seguito dei cambiamenti che intervengono sul modello dei dati.

Le istanze di sottotipi di \texttt{guicontrol.MainPanelPresenter} comprendono dunque, oltre ad alcune operazioni comuni (ad es. per l'inizializzazione o per la comparsa/scomparsa dell'elemento grafico associato), tutte le funzioni di \inglese{callback} richiamate dall'interfaccia grafica.

D'altro canto, dal momento che questo componente è responsabile anche delle modifiche alle viste, le sottoclassi di \texttt{guicontrol.MainPanelPresenter} contengono anche le operazioni richiamate dall'esterno per l'aggiornamento dinamico della GUI\@.

La struttura delle classi che lo compongono mostra una corrispondenza biunivoca con gli elementi grafici presentati nella sezione~\ref{sec:gui} con un \inglese{presenter} per ognuno dei pannelli, cui si aggiunge un oggetto istanza di \texttt{guicontrol.PresenterMediator}.

Quest'ultimo incapsula la collaborazione fra i vari \inglese{presenter} e permette di gestire gli eventi generati da un elemento della GUI inviando a uno (o più) \inglese{presenter} i messaggi corrispondenti alle azioni da compiere.

	\item{\scshape\bfseries Diagramma delle classi:}\\
  \begin{figure}[H]
    \centering
    \includegraphics[width=.9\textwidth]{class_gestione_gui}
    \caption{Diagramma delle classi - Gestione GUI}\label{fig:gestionegui}
  \end{figure}

	\item{\scshape\bfseries Classi utilizzate:}\\
	\begin{itemize}[noitemsep,nolistsep]
	  \item[-] \texttt{guicontrol.AccountSettingsPanelPresenter}
	  \item[-] \texttt{guicontrol.AddressBookPanelPresenter}
	  \item[-] \texttt{guicontrol.CallHistoryPanelPresenter}
	  \item[-] \texttt{guicontrol.CommunicationPanelPresenter}
	  \item[-] \texttt{guicontrol.ContactPanelPresenter}
	  \item[-] \texttt{guicontrol.LanguagePanelPresenter}
	  \item[-] \texttt{guicontrol.MainPanelPresenter}
		\item[-] \texttt{guicontrol.MessagePanelPresenter}
		\item[-] \texttt{guicontrol.PresenterMediator}
	  \item[-] \texttt{guicontrol.ToolsPanelPresenter}
	\end{itemize}
\end{description}

%TODO da rivedere con Tres e Schivo!
\subsubsection{CP04 -- Gestione remota}
\begin{description}
	\item{\scshape\bfseries Descrizione:}\\
Rappresenta l'interfaccia d'accesso verso la sotto-architettura \texttt{clientpresenter}, in particolare per i componenti presenti nel \texttt{server}. La presenza di tale componente svincola il server dal dover conoscere l'esatta sequenza di chiamata dei metodi per portare a conseguimento una determinata procedura in quanto le classi del componente \textsf{Gestione remota} hanno la cognizione dell'iter di chiamate a metodo per portare a termine correttamente le operazioni richieste dall'esterno.

Un esempio di richiesta proveniente dal server che richiede di essere gestita in questa sede è la reazione al cambiamento di stato di un utente presente nella rubrica del client, che si traduce in una notifica in entrata dal server e ha un effetto sull'interfaccia grafica. Un altro esempio è la ricezione di un nuovo messaggio inserito nella propria segreteria dopo un periodo in cui il proprio stato è stato impostato su ``occupato''.

\item{\scshape\bfseries Diagramma delle classi:}
\begin{figure}[H]
  \centering
  \includegraphics[width=.6\textwidth]{class_gestione_remota}
  \caption{Diagramma delle classi - Gestione remota}\label{fig:gestioneremota}
\end{figure}

	\item{\scshape\bfseries Classi utilizzate:} 
	\begin{itemize}[noitemsep,nolistsep]
		\item[-] \texttt{kernel.IRemoteHandler}
		\item[-] \texttt{kernel.RemoteHandler}
	\end{itemize}
\end{description}

\subsection{Descrizione delle classi}

\subsubsection{Package \texttt{org.softwaresynthesis.mytalk.clientpresenter.kernel}}

\begin{itemize}[leftmargin=0em]

%TODO da rivedere con Tres e Schivo!
\item \texttt{CommunicationCenter}
\begin{description}
	\item{\scshape\bfseries Descrizione:}\\
È la classe che ha il compito di gestire la comunicazione con il server reagendo gli eventi che si verificano alla ricezione di un messaggio tramite il canale \texttt{server.connection.IChannel} (nel caso di una comunicazione entrante) oppure inviando tali messaggi al server (nel caso di una comunicazione uscente), al fine di stabilire una comunicazione client-client di tipo WebRTC\@.

Tale classe è inoltre stata implementata come Singleton, al fine di porre un limite superiore pari a uno al numero di istanze che sono presenti in ciascun client.

	\item{\scshape\bfseries Componenti che ne fanno uso:}
	\begin{itemize}[noitemsep,nolistsep]
	  \item[-] \textsf{CP01 -- Gestione comunicazione}
	\end{itemize}
\end{description}

%TODO da rivedere con Tres e Schivo!
\item \texttt{IClientCommunication}
\begin{description}
	\item{\scshape\bfseries Descrizione:}\\
È l'interfaccia che rappresenta un canale di comunicazione client-client e che astrae le primitive di comunicazione dalla tecnologia concreta sottostante.

	\item{\scshape\bfseries Componenti che ne fanno uso:}
	\begin{itemize}[noitemsep,nolistsep]
	  \item[-] \textsf{CP01 -- Gestione comunicazione}
	\end{itemize}
\end{description}

%TODO da rivedere con Tres e Schivo!
\item \texttt{WebRTCCommunication}
\begin{description}
	\item{\scshape\bfseries Descrizione:}\\
È la classe che implementa l'interfaccia \texttt{IClientCommunication}; in particolare tale classe rappresenta una comunicazione client-client configurata in maniera tale da funzionare con WebRTC\@.

	\item{\scshape\bfseries Componenti che ne fanno uso:}
	\begin{itemize}[noitemsep,nolistsep]
	  \item[-] \textsf{CP01 -- Gestione comunicazione}
	\end{itemize}
\end{description}

\item \texttt{JSCall}
\begin{description}
  \item{\scshape\bfseries Descrizione:}\\
Tale classe modella una chiamata appartenente allo storico dell'utente corrente (dove risiede il \inglese{presenter}), e permette di accedere alle informazioni caratteristiche quali il mittente, l'insieme dei destinatari, la durata e la data di inizio della chiamata, sia essa di natura audio oppure audio/video.

Qualora lo storico delle chiamate non fosse disponibile sul client in cui è ospitato il \inglese{presenter}, gli oggetti di tipo \texttt{JSCall} sono creati a seguito di una richiesta da parte di \texttt{guicontrol.CallHistoryPanelPresenter} al fine di ottenere i dati che devono essere visualizzati nell'interfaccia grafica.

  \item{\scshape\bfseries Componenti che ne fanno uso:}
	\begin{itemize}[noitemsep,nolistsep]
	  \item[-] \textsf{CP02 -- Rappresentazione dati}
	  \item[-] \textsf{CP03 -- Gestione GUI}
	\end{itemize}
\end{description}

\item \texttt{JSMessage}
\begin{description}
  \item{\scshape\bfseries Descrizione:}\\
Classe che rappresenta un messaggio presente nella segreteria dell'utente corrente.

I diversi \inglese{presenter} del componente \textsf{Gestione GUI} possono accedere al mittente del messaggio, allo stato del messaggio (ascoltato o non ascoltato), alla natura del messaggio (audio o audio/video), alla durata e, in ultima istanza, al contenuto del messaggio.

I messaggi della segreteria telefonica di un determinato utente vengono scaricati dal \inglese{presenter} \texttt{guicontrol.MessagePanelPresenter} qualora non fossero presenti sul client che ospita il \inglese{presenter} e sono in seguito utilizzati per popolare l'interfaccia grafica.

  \item{\scshape\bfseries Componenti che ne fanno uso:}
	\begin{itemize}[noitemsep,nolistsep]
	  \item[-] \textsf{CP02 -- Rappresentazione dati}
	  \item[-] \textsf{CP03 -- Gestione GUI}
	\end{itemize}
\end{description}

\item \texttt{JSUserData}
\begin{description}
  \item{\scshape\bfseries Descrizione:}\\
Classe avente il compito di rappresentare i contatti della rubrica lato \inglese{presenter}, generato serializzando esclusivamente la parte che si vuole trasmettere ai client delle istanze del \inglese{transfer object} descritto sopra (\texttt{org.softwaresynthesis.mytalk.server.abook.UserData}).

In particolare, di un utente-contatto è possibile ottenere lo \inglese{username}, i dati anagrafici (nome e cognome) nonché l'immagine associata al profilo personale, laddove queste ultime tre informazioni sono da considerarsi facoltative e potrebbero non essere disponibili per un determinato utente.

Gli oggetti \texttt{JSUserData} vengono creati a seguito di una richiesta proveniente dal \inglese{presenter} \texttt{guicontrol.AddressBookPanelPresenter} e sono successivamente impiegati  al fine di popolare l'interfaccia grafica con i dati corrispondenti alla rubrica utente.

  \item{\scshape\bfseries Componenti che ne fanno uso:}
	\begin{itemize}[noitemsep,nolistsep]
	  \item[-] \textsf{CP02 -- Rappresentazione dati}
	  \item[-] \textsf{CP03 -- Gestione GUI}
	\end{itemize}
\end{description}

%TODO da rivedere con Tres e Schivo!
\item \texttt{IRemoteHandler}
\begin{description}
	\item{\scshape\bfseries Descrizione:}\\
Interfaccia che raccoglie la dichiarazione di tutte le operazioni astratte con cui si suppone che il server realizzi lo scambio di messaggi con il \inglese{presenter}.

La sequenza di operazioni da eseguire che interessano i componenti del \inglese{presenter} (ad esempio \textsf{Gestione GUI}) saranno incapsulate nell'implementazione delle operazioni contenute in questa interfaccia.

	\item{\scshape\bfseries Componenti che ne fanno uso:}
	\begin{itemize}[noitemsep,nolistsep]
	  \item[-] \textsf{CP01 -- Gestione remota}
	\end{itemize}
\end{description}

%TODO da rivedere con Tres e Schivo!
\item \texttt{RemoteHandler}
\begin{description}
	\item{\scshape\bfseries Descrizione:}\\
Questa classe rappresenta un'applicazione del \inglese{design pattern} Singleton e implementa inoltre l'interfaccia \texttt{IRemoteHandler}. Fornisce dei metodi concreti utilizzati per ricevere le notifiche provenienti dal server, elaborando qualora necessario i dati ricevuti in input e inoltrando le richieste agli oggetti facenti parte dei diversi componenti del \inglese{presenter}.

Nel caso di un aggiornamento di stato di un contatto presente in rubrica, invece, è necessario modificare l'interfaccia grafica in modo da rispecchiare i cambiamenti avvenuti e quindi anche in questo caso è necessario inoltrare la richiesta al componente \textsf{Gestione GUI}.

Nel caso invece in cui venga inoltrato un nuovo messaggio alla segreteria del cliente, tale evento dovrà essere recepito per mezzo di questa classe e scatenare le operazioni necessarie all'interno del componente \textsf{Gestione GUI}.

	\item{\scshape\bfseries Componenti che ne fanno uso:}
	\begin{itemize}[noitemsep,nolistsep]
	  \item[-] \textsf{CP01 -- Gestione remota}
	\end{itemize}
\end{description}

\end{itemize}

\subsubsection{Package \texttt{org.softwaresynthesis.mytalk.clientpresenter.guicontrol}}
\begin{itemize}[noitemsep,nolistsep]

\item \texttt{guicontrol.AccountSettingsPanelPresenter}
\begin{description}
	\item{\scshape\bfseries Descrizione:}\\
Si tratta del \inglese{presenter} richiamato dall'elemento grafico corrispondente al pannello \texttt{org.softwaresynthesis.mytalk.clientview.AddressBookPanel} per la gestione dei dati relativi all'utente associato al client.

Per questo motivo, l'oggetto \texttt{AccountSettingsPanelPresenter} ha il duplice compito di interrogare il server tramite il componente \textsf{Façade del server}per procurarsi i dati da visualizzare qualora essi non fossero disponibili sul client, nonché di mettere a disposizione per la vista le funzioni di \inglese{callback} che comportano la modifica di questi stessi dati. 

	\item{\scshape\bfseries Componenti che ne fanno uso:}
	\begin{itemize}[noitemsep,nolistsep]
	  \item[-] \textsf{CP03 -- Gestione GUI}
	  \item[-] \textsf{CV01 -- GUI}
	\end{itemize}
\end{description}

\item \texttt{guicontrol.AddressBookPanelPresenter}
\begin{description}
	\item{\scshape\bfseries Descrizione:}\\
Tale \inglese{presenter} viene richiamato dall'elemento grafico corrispondente al pannello della rubrica (\texttt{org.softwaresynthesis.mytalk.clientview.AddressBookPanel}) e contiene la risposta a eventi quali la selezione di un contatto dalla rubrica da parte dell'utente. Contiene inoltre un'operazione di \inglese{refresh} che visualizza una lista di contatti ricevuta in input in forma grafica sulla UI\@.

Il \inglese{presenter} in questione rende inoltre possibile avviare una ricerca fra gli utenti registrati nel sistema nonché rilevare che l'operazione di ricerca è conclusa (e conseguentemente visualizzare nuovamente la rubrica). Inoltre comprende anche le funzioni di \inglese{callback} per alcune operazioni di amministrazione sulla rubrica, come la creazione e l'eliminazione di un gruppo.

I dati corrispondenti alla rubrica, ovvero le corrispondenti istanze di classi definite in \textsf{Rappresentazione dati}, se non sono presenti sul client devono essere recuperati dal server ed è responsabilità di questa classe contattare il \textsf{Façade del Server} al fine di ottenere le informazioni necessarie.

Infine, in modo simile sono comunicati al server gli esiti delle operazioni di amministrazione sulla rubrica che hanno un effetto sulle informazioni di modello.

	\item{\scshape\bfseries Componenti che ne fanno uso:}
	\begin{itemize}[noitemsep,nolistsep]
	  \item[-] \textsf{CP03 -- Gestione GUI}
	  \item[-] \textsf{CV01 -- GUI}
	\end{itemize}
\end{description}

\item \texttt{guicontrol.CallHistoryPanelPresenter}
\begin{description}
	\item{\scshape\bfseries Descrizione:}\\
Questo \inglese{presenter} gestisce l'elemento corrispondente al pannello dello storico delle chiamate presente nell'interfaccia grafica, permettendo la visualizzazione di un array di chiamate corrispondenti alle comunicazioni di un determinato utente.

Poiché il componente grafico supervisionato è totalmente passivo, non sono presenti operazioni di \inglese{callback} da associare alle componenti grafiche vere e proprie.

Qualora i dati corrispondenti allo storico delle chiamate non fossero disponibili sul client che ospita questo \inglese{presenter} è inoltre responsabilità di quest'ultimo interrogare il server (attraverso il componente \textsf{Façade del server}) al fine di ottenere le informazioni necessarie.

	\item{\scshape\bfseries Componenti che ne fanno uso:}
	\begin{itemize}[noitemsep,nolistsep]
	  \item[-] \textsf{CP03 -- Gestione GUI}
	  \item[-] \textsf{CV01 -- GUI}
	\end{itemize}
\end{description}

\item \texttt{guicontrol.CommunicationPanelPresenter}
\begin{description}
	\item{\scshape\bfseries Descrizione:}\\
Tale \inglese{presenter} si occupa della gestione del componente grafico corrispondente al pannello di comunicazione fra utenti. In particolare, comprende le operazioni necessarie all'aggiornamento della grafica corrispondente alle chat testuali e alle condivisioni, nonché alla visualizzazione dello \inglese{stream} video nel corso di una comunicazione audio/video o dell'immagine associata al profilo utente nel caso di una sola comunicazione audio.

Le principali funzioni di \inglese{callback} utilizzate dall'interfaccia grafica presenti in questa classe corrispondono alla possibilità di interrompere una chiamata in corso, avviare/interrompere una condivisone di risorse, avviare/interrompere una registrazione, visualizzare/nascondere le aree di chat (che sono indipendenti dalla comunicazione corrente).

	\item{\scshape\bfseries Componenti che ne fanno uso:}
	\begin{itemize}[noitemsep,nolistsep]
	  \item[-] \textsf{CP03 -- Gestione GUI}
	  \item[-] \textsf{CV01 -- GUI}
	\end{itemize}
\end{description}

\item \texttt{guicontrol.ContactPanelPresenter}
\begin{description}
	\item{\scshape\bfseries Descrizione:}\\
Tale \inglese{presenter} ha la responsabilità di controllare l'aggiornamento della sezione dell'interfaccia grafica incaricata di visualizzare il profilo di un utente in risposta alla selezione dalla rubrica o dall'esito di una ricerca.

Poiché, inoltre, a partire da tale componente grafico è possibile avviare una comunicazione, tale classe comprende al proprio interno anche le funzioni che devono essere richiamate in risposta all'azione da parte dell'utente di dare avvio a una comunicazione.

Poiché da \texttt{org.softwaresynthesis.mytalk.clientview.ContactPanel} è possibile anche svolgere alcune attività di amministrazione della rubrica utente, in questo \inglese{presenter} sono presenti anche le funzioni di \inglese{callback} necessarie per l'aggiunta e la rimozione di un contatto particolare ad un gruppo, nonché per l'aggiunta di contatto alla rubrica se il suo profilo è stato aperto a seguito di una ricerca fra gli utenti registrati nel sistema.

Dal momento che, infine, tali operazioni di amministrazione hanno un effetto sulle entità del modello dei dati che risiedono sul server, tale classe ha la responsabilità di notificare gli aggiornamenti sul server al fine di mantenere la consistenza delle informazioni.

	\item{\scshape\bfseries Componenti che ne fanno uso:}
	\begin{itemize}[noitemsep,nolistsep]
	  \item[-] \textsf{CP03 -- Gestione GUI}
	  \item[-] \textsf{CV01 -- GUI}
	\end{itemize}
\end{description}

\item \texttt{guicontrol.LanguagePanelPresenter}
\begin{description}
	\item{\scshape\bfseries Descrizione:}\\
Il \inglese{presenter} in questione ha il compito di popolare il contenuto dell'elemento grafico corrispondente al pannello di configurazione della UI e, in particolare, della lingua in cui questa viene visualizzata.

Contiene un'unica operazione di \inglese{callback} per la grafica, che riceve la selezione dell'utente e propaga le modifiche a tutti i \inglese{presenter} associati alle componenti grafiche. Non ammette invece alcuna operazione di aggiornamento della GUI in quanto gli elementi da visualizzare sono noti al momento dell'inizializzazione e non subiscono modifiche ulteriori a tempo di esecuzione.

	\item{\scshape\bfseries Componenti che ne fanno uso:}
	\begin{itemize}[noitemsep,nolistsep]
	  \item[-] \textsf{CP03 -- Gestione GUI}
	  \item[-] \textsf{CV01 -- GUI}
	\end{itemize}
\end{description}

\item \texttt{guicontrol.MainPanelPresenter}
\begin{description}
	\item{\scshape\bfseries Descrizione:}\\
Classe base per i \inglese{presenter} associati ai diversi componenti dell'interfaccia grafica che contiene i metodi necessari all'inizializzazione di questi ultimi nonché i controlli che ne attivano la comparsa o scomparsa in risposta alle preferenze di visualizzazione dell'utente.

	\item{\scshape\bfseries Componenti che ne fanno uso:}
	\begin{itemize}[noitemsep,nolistsep]
	  \item[-] \textsf{CP03 -- Gestione GUI}
	  \item[-] \textsf{CV01 -- GUI}
	\end{itemize}
\end{description}

\item \texttt{guicontrol.MessagePanelPresenter}
\begin{description}
	\item{\scshape\bfseries Descrizione:}\\
Tale \inglese{presenter} contiene le operazioni necessarie a visualizzare l'elenco dei messaggi presenti nella segreteria telefonica di un determinato utente.

Poiché a partire dalla vista associata è possibile avviare/arrestare la riproduzione di un messaggio, questo oggetto deve contenere opportune funzioni di \inglese{callback} per rispondere alle richieste dell'utente in tal senso. La cancellazione di un messaggio, corrispondente al requisito RUFF15.4.0, è anch'essa possibile attraverso un'operazione di questo \inglese{presenter}, così come il cambiamento di stato del messaggio una volta che viene ascoltato.

È prevista inoltre la possibilità di aggiornamento del componente grafico, in quanto la ricezione di nuovi messaggi può avvenire anche se l'utente è in linea (ad esempio se questi è impegnato in un'altra conversazione).

Qualora i dati corrispondenti alla segreteria telefonica di un utente non fossero disponibili sul client, è responsabilità di questa classe interrogare il server al fine di ottenere le informazioni necessarie nonché istanziare le opportune classi di \textsf{Rappresentazione dati}.

Infine, per le operazioni che hanno effetto sulla rappresentazione del modello dei dati sul server, quali la cancellazione di un messaggio o il cambiamento di stato di un messaggio, devono essere notificati al server attraverso il componente \textsf{Façade del server}.

	\item{\scshape\bfseries Componenti che ne fanno uso:}
	\begin{itemize}[noitemsep,nolistsep]
	  \item[-] \textsf{CP03 -- Gestione GUI}
	  \item[-] \textsf{CV01 -- GUI}
	\end{itemize}
\end{description}

\item \texttt{guicontrol.PresenterMediator}
\begin{description}
	\item{\scshape\bfseries Descrizione:}\\
L'istanza di tale classe ha il compito di gestire le collaborazioni fra i diversi \inglese{presenter} associati alle viste dell'interfaccia grafica e smistare i messaggi che questi si devono scambiare.

A tale scopo, è necessario che tutti i \inglese{presenter} si registrino su di essa in modo da poter ricevere le successive richieste tramite chiamata di metodo. Inoltre, questi ultimi sono in grado di notificare gli eventi di interesse al \texttt{PresenterMediator} che resta costantemente in ascolto su di essi.

	\item{\scshape\bfseries Componenti che ne fanno uso:}
	\begin{itemize}[noitemsep,nolistsep]
	  \item[-] \textsf{CP03 -- Gestione GUI}
	  \item[-] \textsf{CP04 -- Gestione remota}
	\end{itemize}
\end{description}

\item \texttt{guicontrol.ToolsPanelPresenter}
\begin{description}
	\item{\scshape\bfseries Descrizione:}\\
Tramite tale \inglese{presenter} è possibile inizializzare la barra laterale degli strumenti rappresentata da \texttt{org.softwaresynthesis.mytalk.clientview.ToolsPanel}. Gli aggiornamenti cui tale porzione della vista è soggetta consistono nella visualizzazione/scomparsa di uno o più strumenti su richiesta dell'utente e per ognuno di questi è prevista la presenza di un'operazione.

D'altra parte, gli eventi scatenati dall'interazione dell'utente con il pannello degli strumenti che comportano la modifica dell'elemento mostrato nella regione centrale al posto del pannello principale, sono raccolti da questo \inglese{presenter} e inoltrati al \texttt{PresenterMediator} per la gestione.

In tal modo è possibile far comparire o scomparire il pannello di gestione dei dati personali corrispondenti al proprio account, della segreteria, lo storico delle chiamate e la selezione della lingua.

Poiché inoltre da \texttt{org.softwaresynthesis.mytalk.clienview.ToolsPanel} è possibile impostare il proprio stato, il \inglese{presenter} ad esso associato contiene le funzioni che notificano l'avvenuto cambiamento di stato al componente \textsf{Façade del server}.

	\item{\scshape\bfseries Componenti che ne fanno uso:}
	\begin{itemize}[noitemsep,nolistsep]
	  \item[-] \textsf{CP03 -- Gestione GUI}
	  \item[-] \textsf{CV01 -- GUI}
	\end{itemize}
\end{description}

\end{itemize}

\begin{figure}[H]
  \centering
  \includegraphics[width=.8\textwidth]{presenter_generale}
  \caption{Diagramma delle classi - Architettura \texttt{mytalk.clientpresenter}}\label{fig:sottoarchpresenter}
  \end{figure}
\clearpage

\section{Architettura \texttt{mytalk.clientview}}\label{sec:clientview}
Come già accennato in precedenza, nella sezione \ref{sec:introdesign} e \ref{sec:clientpresenter}, \texttt{clientview} ha il compito di definire la struttura di visualizzazione dei dati costituendo la GUI del sistema lato client.

Le motivazioni che hanno portato a separare tale sotto-architettura dalla parte logica sono da ricercare nei vantaggi di riutilizzo del codice e semplificazione della manutenzione:
\begin{itemize}
 	\item \textbf{future espansioni}: innanzitutto tale scelta permetterà ai progettisti di sviluppare (in futuro) molteplici tipologie di ``viste'', implementabili liberamente svincolando i programmatori dal conoscere al dettaglio la logica sottostante per la gestione delle comunicazioni.
 	\item \textbf{semplificare la manutenzione}: così come scrivere da zero una nuova vista, anche modificare quelle già presenti risulta essere più facile, per gli stessi motivi descritti al punto precedente.
\end{itemize}

La sotto-architettura \texttt{clientview} rappresenta quindi una vista di \inglese{default} fornita dal team, con lo scopo di rappresentare in modo chiaro ed organizzato le possibilità di iterazione, da parte dell'utente finale, con l'applicativo \caName.

Nell'utilizzare tale vista l'utente non avrà la percezione di come sia stata progettata l'architettura totale del sistema, svincolandolo cosi dal dover conoscere le procedure necessarie all'esecuzione di una determinata operazione.

In figura \ref{fig:gui} si riporta un abbozzo dell'interfaccia grafica utente realizzata mediante le classi di questa sotto-architettura. In conformità con quanto stabilito dai requisiti (RSDO10.0.0) l'interfaccia si sviluppa in un'unica pagina.

\begin{figure}[h]
  \centering
  \includegraphics[width=.9\textwidth]{GUI}
  \caption{Rappresentazione ad alto livello della GUI}\label{fig:gui}
\end{figure}

Per quanto riguarda la componentistica, la sotto-architettura \texttt{clientview} è costituita dal solo componente \textsf{CV01 -- GUI}, per le specifiche del quale si rimanda alla sezione successiva. I nomi di tutte le classi riportate nella presente sezione sono inoltre implicitamente parte del package \texttt{org.softwaresynthesis.mytalk.clientview}, pertanto tale prefisso sarà omesso nella loro denominazione.

Analogamente a quanto osservato per la sotto-architettura \texttt{clientpresenter}, la rappresentazione tramite classi e oggetti è utilizzata a livello prettamente logico indipendentemente dal dominio applicativo concreto di implementazione.

In riferimento alla bozza di interfaccia utente presentata in figura \ref{fig:gui}, la parte denominata \texttt{AddressBookPanel} conterrà la lista degli utenti nella rubrica, mentre \texttt{ToolsPanel} conterrà i componenti grafici che rappresentano tutte le funzionalità offerte dal sistema. 

Il contenuto del \texttt{MainPanel}, invece, è destinato in relazione alla funzionalità scelta dall'utente in quel momento. Ad esempio, qualora l'utente selezioni un contatto presente nella rubrica, verrà visualizzato il profilo corrispondente al contatto scelto in \texttt{ContactPanel}, mentre nel caso in cui si attiva una forma di comunicazione, sarà visibile la parte grafica di un'istanza di \texttt{CommunicationPanel}.

\subsection{Componenti evidenziati}

\subsubsection{CV01 -- GUI}\label{sec:gui}
\begin{description}
	\item{\scshape\bfseries Descrizione:}\\
Questo componente si occupa della presentazione dell'interfaccia grafica presentata all'utente finale. Le classi in esso contenute servono pertanto per la visualizzazione dei punti di accesso alle funzionalità offerte dal sistema all'utente.

Si noti che tale componente demanda tutta la logica di applicazione al \inglese{presenter} ed è quindi relativo solo ed esclusivamente alla grafica. Tutti i pannelli, che corrispondono ad altrettante viste, hanno pertanto un canale di comunicazione aperto con il \inglese{presenter} loro associato, e gli eventi generati dall'utente devono essere gestiti collegando l'evento alle opportune funzioni di \inglese{callback} offerte dai \inglese{presenter}.

	\item{\scshape\bfseries Diagramma delle classi:}
Il diagramma non è riportato perché, coincidendo le classi di questo componente con l'intera sotto-architettura \texttt{clientview}, esso verrebbe ad essere identico a quello presentato in figura \vref{fig:sottoarchview}. Si rimanda pertanto a quest'ultimo per la rappresentazione UML del componente GUI\@.
	
	\item{\scshape\bfseries Classi utilizzate:} 
	\begin{itemize}[noitemsep,nolistsep]
		\item[-] \texttt{MainPanel}
		\item[-] \texttt{ToolsPanel}
		\item[-] \texttt{AddressBookPanel}
		\item[-] \texttt{ContactPanel}
		\item[-] \texttt{MessagePanel}
		\item[-] \texttt{LanguagePanel}
		\item[-] \texttt{AccountSettingsPanel}
		\item[-] \texttt{CallHistoryPanel}
		\item[-] \texttt{CommunicationPanel}
	\end{itemize}  
\end{description}

\subsection{Descrizione delle classi}

\subsubsection{Package \texttt{org.softwaresynthesis.clientview}}

\begin{itemize}[leftmargin=0em]

\item \texttt{AddressBookPanel}
\begin{description}
  \item{\scshape\bfseries Descrizione}\\
Pannello che permette la visualizzazione della rubrica dell'utente connesso al sistema, e di accedere ad alcune delle funzionalità di amministrazione della rubrica stessa (ad esempio l'aggiunta o la rimozione di gruppi).

In questo pannello sono anche presenti le funzionalità di ricerca fra gli utenti presenti nel sistema, con la visualizzazione dei risultati della ricerca al posto della lista dei contatti presenti in rubrica.

  \item{\scshape\bfseries Componenti che ne fanno uso:}
  \begin{itemize}[noitemsep,nolistsep]
    \item[-] \textsf{CV01 -- GUI}
    \item[-] \textsf{CP03 -- Gestione GUI}
  \end{itemize}
\end{description}

\item \texttt{MainPanel}
\begin{description}
  \item{\scshape\bfseries Descrizione}\\
Classe padre della gerarchia di oggetti grafici che possono comparire nella sezione principale dell'interfaccia utente. Ogni sua specializzazione definisce un nuovo tipo di pannello che costituisce l'elemento in primo piano dell'applicazione.

  \item{\scshape\bfseries Componenti che ne fanno uso:}
  \begin{itemize}[noitemsep,nolistsep]
    \item[-] \textsf{CV01 -- GUI}
    \item[-] \textsf{CP03 -- Gestione GUI}
  \end{itemize}
\end{description}

\item \texttt{ToolsPanel}
\begin{description}
  \item{\scshape\bfseries Descrizione}\\
Classe che rappresenta il pannello degli strumenti della \inglese{home screen} dell'applicativo, mediante il quale è possibile accedere alle funzionalità di ricerca, di segreteria telefonica, selezione della lingua, modifica dei dati dell'utente e storico delle chiamate.

All'occorrenza il pannello può essere messo in secondo piano e non essere più visibile per intero nella finestra principale. Inoltre, in questo pannello è visualizzato lo stato corrente dell'utente ed è possibile modificarlo per passare da ``occupato'' a ``disponibile'' o per disconnettersi e passare a ``\inglese{offline}''.

  \item{\scshape\bfseries Componenti che ne fanno uso:}
  \begin{itemize}[noitemsep,nolistsep]
    \item[-] \textsf{CV01 -- GUI}
    \item[-] \textsf{CP03 -- Gestione GUI}
  \end{itemize}
\end{description}

\item \texttt{ContactPanel}
\begin{description}
  \item{\scshape\bfseries Descrizione}\\
Sottoclasse di \texttt{MainPanel} utilizzata per rappresentare il profilo di un utente. Solo accedendo quest'ultimo sarà possibile avviare una comunicazione con l'utente. Il contatto viene visualizzato selezionando l'utente dalla rubrica oppure tra i risultati di una ricerca.

Attraverso questo pannello è inoltre possibile effettuare alcune operazioni di amministrazione sulla rubrica: aggiungere o rimuovere un utente ad uno dei gruppi della propria rubrica, bloccare un contatto o, se il profilo visualizzato corrisponde a un utente che non appartiene alla rubrica personale, aggiungerlo ad essa.

  \item{\scshape\bfseries Componenti che ne fanno uso:}
  \begin{itemize}[noitemsep,nolistsep]
    \item[-] \textsf{CV01 -- GUI}
    \item[-] \textsf{CP03 -- Gestione GUI}
  \end{itemize}
\end{description}

\item \texttt{MessagePanel}
\begin{description}
  \item{\scshape\bfseries Descrizione}\\
Questa sottoclasse di \texttt{MainPanel} permette di accedere all'elenco dei messaggi in segreteria di un determinato utente e ne permette la gestione. La visualizzazione si attiva quando viene premuto il relativo pulsante mostrato dall'istanza di \texttt{ToolsPanel}.

Tramite questo elemento grafico è possibile anche riprodurre il contenuto di un messaggio, dopo che quest'ultimo è stato scaricato dal server (se non era già presente in memoria), arrestarne la riproduzione oppure cancellarlo se non si desidera che venga conservato.

  \item{\scshape\bfseries Componenti che ne fanno uso:}
  \begin{itemize}[noitemsep,nolistsep]
    \item[-] \textsf{CV01 -- GUI}
    \item[-] \textsf{CP03 -- Gestione GUI}
  \end{itemize}
\end{description}

\item \texttt{LanguagePanel}
\begin{description}
  \item{\scshape\bfseries Descrizione}\\
Questa sottoclasse di \texttt{MainPanel} è impiegata per permettere da parte dell'utente finale la selezione della lingua desiderata. La visualizzazione del pannello avviene in seguito all'attivazione del pulsante corrispondente situato nel pannello degli strumenti.

  \item{\scshape\bfseries Componenti che ne fanno uso:}
  \begin{itemize}[noitemsep,nolistsep]
    \item[-] \textsf{CV01 -- GUI}
    \item[-] \textsf{CP03 -- Gestione GUI}
  \end{itemize}
\end{description}

\item \texttt{AccountSettingsPanel}
\begin{description}
  \item{\scshape\bfseries Descrizione}\\
Questa classe è utilizzata per rappresentare il \underline{\inglese{form}} che si presenta all'utente per la modifica dei propri dati. Costituisce inoltre una sottoclasse di \texttt{MainPanel} e viene visualizzata quando l'utente preme il relativo pulsante nel pannello degli strumenti.

  \item{\scshape\bfseries Componenti che ne fanno uso:}
  \begin{itemize}[noitemsep,nolistsep]
    \item[-] \textsf{CV01 -- GUI}
    \item[-] \textsf{CP03 -- Gestione GUI}
  \end{itemize}
\end{description}

\item \texttt{CallHistoryPanel}
\begin{description}
  \item{\scshape\bfseries Descrizione}\\
Questa classe estende \texttt{MainPanel} e viene impiegata per rappresentare lo storico delle chiamate visualizzato quando l'utente attiva il pulsante corrispondente presente nel \texttt{ToolsPanel}. Oltre alla visualizzazione dello storico delle chiamate non è prevista alcuna forma di interazione attiva con l'utente.

  \item{\scshape\bfseries Componenti che ne fanno uso:}
  \begin{itemize}[noitemsep,nolistsep]
    \item[-] \textsf{CV01 -- GUI}
    \item[-] \textsf{CP03 -- Gestione GUI}
  \end{itemize}
\end{description}

\item \texttt{CommunicationPanel}
\begin{description}
  \item{\scshape\bfseries Descrizione}\\
Tale componente grafico si attiva nel momento in cui è stata avviata una forma di comunicazione, sia essa audio, audio/video oppure testuale. Per le comunicazioni audio e audio/video consente la visualizzazione dell'immagine associata al profilo dei destinatari oppure dei relativi \inglese{stream} video e permette di visualizzare le risorse condivise.

Inoltre, tale entità grafica prevede anche la presenza di una o più aree di chat che non corrispondono necessariamente alla comunicazione in corso (perché è possibile avere più comunicazioni testuali in parallelo fra loro e con una comunicazione multimediale).

  \item{\scshape\bfseries Componenti che ne fanno uso:}
  \begin{itemize}[noitemsep,nolistsep]
    \item[-] \textsf{CV01 -- GUI}
    \item[-] \textsf{CP03 -- Gestione GUI}
  \end{itemize}
\end{description}

\end{itemize}

\begin{figure}[H]
  \centering
  \includegraphics[width=1\textwidth]{class_gui}
  \caption{Diagramma delle classi - Architettura \texttt{mytalk.clientview}}\label{fig:sottoarchview}
\end{figure}
\clearpage

\section{Design pattern utilizzati}
In conformità con quanto stabilito nella sezione 7.2 del documento \textit{norme\_di\_progetto.3.0.pdf}, per ognuno dei \inglese{design pattern} sono riportati lo scopo e una descrizione del contesto di applicazione del \inglese{pattern} all'interno di un componente, evidenziando in particolar modo i vantaggi derivati e riportando un diagramma esemplificativo.

Per una visione d'insieme dei componenti utilizzati da un \inglese{pattern}, e dei \inglese{pattern} utilizzati da un componente, si rimanda alle sottosezioni ``Tracciamenti Componenti-Design Pattern'' e ``Tracciamenti Design Pattern-Componenti'' della sezione \vref{sec:tracciamenti}.

\subsection{Data Access Object (DAO)}\label{sec:patterndao}

\subsubsection{Scopo}
Il \inglese{pattern} DAO ha lo scopo di disaccoppiare la logica di \inglese{business} dalla logica di accesso ai dati

Questo si ottiene spostando la logica di accesso ai dati dai componenti di \inglese{business} stessi ad una classe DAO ad hoc per il DBMS scelto, rendendo i componenti che implementano la \inglese{business logic} indipendenti dalla natura del dispositivo di persistenza.

Un simile approccio garantisce che un eventuale cambiamento del dispositivo di persistenza non comporti modifiche sui componenti di \inglese{business}.

\subsubsection{Componenti che lo implementano}
\begin{description}
\item{\scshape\bfseries CS01 -- Gestione database}\\
Le classi DAO consentono di isolare l'accesso alle tabelle del database dalla parte di \inglese{business logic} corrispondente alle entità TO, incapsulando in metodi di alto livello le operazioni sui record del database sottostante.

\begin{figure}[H]
  \centering
  \includegraphics[width=.95\textwidth]{pattern_dao}
  \caption{Applicazione del \inglese{pattern} Data Access Object}\label{fig:dao}
\end{figure}

Operando una distinzione di questo tipo, gli utenti esterni possono considerare gli oggetti che richiedono la mappatura nel database alla stregua di normali oggetti Java (POJO) senza preoccuparsi del meccanismo di persistenza dei dati.
\end{description}

\subsection{Façade}\label{sec:patternfacade}

\subsubsection{Scopo}
Fornire un'interfaccia unificata per un insieme di interfacce o classi presenti in una sotto-architettura, nascondendo i dettagli implementativi di quest'ultima.

Façade definisce inoltre un'interfaccia di livello più alto che rende la sotto-architettura più semplice da utilizzare e riduce il numero di dipendenze funzionali fra i componenti appartenenti a sotto-architetture esterne e le classi del server.

\subsubsection{Componenti che lo implementano}
\begin{description}
  \item{\scshape\bfseries CS07-- Façade del server}\\
Questa componente della sotto-architettura server fornisce una serie di punti di accesso centralizzati per i componenti \textsf{Gestione rubrica}, \textsf{Gestione connessione}, \textsf{Gestione segreteria}, \textsf{Gestione chiamate} e \textsf{Gestione autentcazione} secondo la tabella riportata nella sezione \vref{sec:cs07}.
\end{description}

\subsubsection*{Classe \texttt{org.softwaresynthesis.mytalk.server.abook.AccountManager}}
La \inglese{servlet} \texttt{AccountManager} rappresenta un punto di accesso alle funzionalità del componente \textsf{Gestione rubrica} per quanto riguarda la gestione dei dati relativi al proprio account che sono memorizzati sul server.

A tal fine, come illustrato in figura \ref{fig:facadeaddressbook1}, è prevista una collaborazione con l'interfaccia \texttt{abook.IUserData} per la manipolazione dei \inglese{transfer object} associati agli utenti nonché con la classe DAO \texttt{dao.UserDataDAO}, necessaria per riflettere i cambiamenti richiesti dagli utenti su quanto memorizzato nelle tabelle del database.

\begin{figure}[H]
  \centering
%   \includegraphics[width=.7\textwidth]{}
  \caption{Applicazione del \inglese{pattern} Façade a \textsf{Gestione rubrica}}\label{fig:facadeaddressbook1}
\end{figure}

\subsubsection*{Classe \texttt{org.softwaresynthesis.mytalk.server.abook.AddressBookManager}}
La \inglese{servlet} \texttt{AddressBookManager} rappresenta un punto di accesso alle funzionalità del componente \textsf{Gestione rubrica} per quanto concerne le operazioni di amministrazione della rubrica che hanno come oggetto i contatti di una rubrica utente come l'inserimento/cancellazione di un contatto, la creazione/eliminazione di un gruppo o l'aggiunta/rimozione di un contatto da un determinato gruppo.

A tal fine, come illustrato dal diagramma in figura \ref{fig:facadeaddressbook2}, è prevista una collaborazione fra la \inglese{servlet} \texttt{AddressBookManager} e l'interfaccia \texttt{abook.IAddressBookEntry} e \texttt{abook.IGroup} nonché con \texttt{dao.AddressBookEntryDAO} e \texttt{dao.GroupDAO} per memorizzare nel database che risiede sul server le nuove informazioni risultanti delle interazioni con l'utente.

\begin{figure}[H]
  \centering
%   \includegraphics[width=.7\textwidth]{}
  \caption{Applicazione del \inglese{pattern} Façade a \textsf{Gestione rubrica}}\label{fig:facadeaddressbook2}
\end{figure}

\subsubsection*{Classe \texttt{org.softwaresynthesis.mytalk.server.connection.ConnectionManager}}
La \inglese{servlet} \texttt{ConnectionManager} fornisce un punto di accesso centralizzato alle funzionalità del componente \textsf{Gestione connessione}, per gestire la comunicazione client-server.

Tramite l'\inglese{overriding} del metodo \texttt{createWebSocketInbound(String, HttpServletRequest} presente nella sua superclasse \texttt{org.apache.catalina.websocket.WebSocketServlet} la \inglese{servlet} permette di restituire ai client un canale di comunicazione bidirezionale verso il server, che lato server è istanza di un sottotipo di \texttt{org.apache.catalina.websocket.StreamInbound}.


\begin{figure}[H]
  \centering
%   \includegraphics[width=.7\textwidth]{}
  \caption{Applicazione del \inglese{pattern} Façade a \textsf{Gestione connessione}}\label{fig:facadeconnection}
\end{figure}

\subsubsection*{Classe \texttt{org.softwaresynthesis.mytalk.server.abook.StateManager}}
La \inglese{sevlet} \texttt{StateManager} rappresenta un punto di accesso centralizzato al componente del server \textsf{Gestione rubrica} in quanto permette ai client di cambiare il proprio stato.

A tal fine, come illustrato dal diagramma riportato in figura \ref{fig:facadestate} è prevista la collaborazione con l'interfaccia \texttt{abook.IUserData} e con la classe \texttt{abook.State}.

\begin{figure}[H]
  \centering
%   \includegraphics[width=.7\textwidth]{}
  \caption{Applicazione del \inglese{pattern} Façade a \textsf{Gestione stato}}\label{fig:facadestate}
\end{figure}

\subsubsection*{Classe \texttt{org.softwaresynthesis.mytalk.server.message.MessageManager}}
La \inglese{servlet} \texttt{MessageManager} ha il compito di esporre verso i client le funzionalità del componente \textsf{Gestione segreteria} del server.

A tal fine è prevista la collaborazione con le interfacce \texttt{message.IMessage} e \texttt{abook.IUserData}. Poiché inoltre il recupero dei messaggi, i cambiamenti sullo stato dei messaggi, e l'eliminazione di questi ultimi hanno degli effetti sulla rappresentazione in forma persistente dei dati sul server, è prevista inoltre una collaborazione con la classe DAO e \texttt{dao.MessageDAO}.

\begin{figure}[H]
  \centering
%   \includegraphics[width=.7\textwidth]{}
  \caption{Applicazione del \inglese{pattern} Façade a \textsf{Gestione segreteria}}\label{fig:facademessage}
\end{figure}

\subsubsection*{Classe \texttt{org.softwaresynthesis.mytalk.server.call.CallManager}}
La \inglese{servlet} \texttt{CallHistoryManager} ha la responsabilità di esporre ai client alcune delle funzionalità del componente \textsf{Gestione chiamate} per l'interrogazione del database in merito allo storico delle chiamate e scaricamento dei dati corrispondenti.

A tal fine è prevista la collaborazione con le interfacce \texttt{IUserData}, \texttt{ICall} e, per l'interrogazione del database anche con la classe AO associata \texttt{CallDAO}.

\begin{figure}[H]
  \centering
%   \includegraphics[width=.7\textwidth]{}
  \caption{Applicazione del \inglese{pattern} Façade a \textsf{Gestione chiamate}}\label{fig:facadecall}
\end{figure}

\subsubsection*{Classe \texttt{org.softwaresynthesis.mytalk.server.authentication.LoginManager}}
La \inglese{servlet} \texttt{LoginManager} ha la responsabilità di autenticare un utente nel sistema mytalk, permettendogli quindi, se la procedura ha avuto esito positivo, di utilizzare le funzioni offerte dal sistema.

\begin{figure}[H]
  \centering
%   \includegraphics[width=.7\textwidth]{}
  \caption{Applicazione del \inglese{pattern} Façade a \textsf{Gestione autenticazione}}\label{fig:facadeauthentication}
\end{figure}

\subsection{Factory Method}\label{sec:patternfactorymethod}

\subsubsection{Scopo}
Definisce un'interfaccia per la creazione di un oggetto, lasciando alle sottoclassi la decisione sulla classe concreta che deve essere istanziata e consente di deferire l'istanziazione di una classe alle sottoclassi.

\subsubsection{Componenti che lo implementano}
\begin{description}

  \item{\scshape\bfseries CS02 -- Gestione connessione}\\
Gli oggetti che intendono rappresentare connessioni sono sottotipi di della classe di libreria \texttt{org.apache.catalina.websocket.StreamInbound} e vengono instanziati mediante un Factory Method nelle sottoclassi di \texttt{org.apache.catalina.websocket.WebSocketServlet}.

\begin{figure}[H]
  \centering
  \includegraphics[width=.8\textwidth]{pattern_factorymethod}
  \caption{Applicazione del \inglese{pattern} Factory Method}\label{fig:factory_method}
\end{figure}

In particolare, la classe \texttt{connection.ConnectionManager} restituisce un oggetto che rappresenta la connessione di tipo dinamico \texttt{connection.PushInbound} che implementa il comportamento come reazione ai messaggi in ingresso facendo a sua volta \inglese{overriding} del metodo \texttt{onTextMessage(CharBuffer)}.
\end{description}

\subsection{Model-View-Presenter}\label{sec:MVP}

\subsubsection{Scopo}
Il pattern architetturale \inglese{Model-View-Presenter} similmente a quanto accade per \inglese{Model-View-Controller} (MVC), ha lo scopo di mantenere separata la \inglese{business logic}, cioè la gestione dei dati secondo le regole di un determinato dominio e la loro memorizzazione in forma persistente, dalla presentazione e manipolazione mediante interfaccia utente.


\begin{figure}[H]
  \centering
  \includegraphics[width=.8\textwidth]{mvpHLdiagram}
  \caption{Diagramma ad alto livello del \inglese{pattern} MVP}\label{fig:mvpHL}
\end{figure}

\begin{figure}[H]
  \centering
  \includegraphics[width=\textwidth]{diagrammasequenzaMVP}
  \caption{Diagramma di sequenza che illustra le collaborazioni in MVP}\label{fig:mvpSD}
\end{figure}

Come si evince dal diagramma riportato in figura \ref{fig:mvpSD} le interazioni avvengono solo tra \inglese{view} e \inglese{presenter} oppure tra \inglese{presenter} e \inglese{model}, senza che avvenga mai uno scambio di dati diretto fra \inglese{model} e \inglese{view}.

Ciò si deve al fatto che la \inglese{business logic} e il modello dei dati risiedono nel server mentre il \inglese{presenter} e la \inglese{view} sono situati nel client. Quando un utente richiede un servizio tramite l'interfaccia grafica, la richiesta viene inoltrata dalla \inglese{view} al \inglese{presenter}.

Qualora quest'ultimo fosse in grado di soddisfare tale richiesta con le risorse di cui dispone, i dati sono restituiti immediatamente alla \inglese{view} senza alcun bisogno di richiedere l'intervento del server. Nel caso, invece, in cui il \inglese{presenter} non fosse in grado di servire autonomamente la \inglese{view}, interrogherebbe il server al fine di ottenere i dati da restituire alla componente grafica.

Il vantaggio di un simile schema di interazione consiste nella riduzione del traffico di rete e nel conseguente incremento delle prestazioni in termini di velocità e, di conseguenza, dell'esperienza utente in generale.

\subsubsection{Componenti che lo implementano}
MVP viene utilizzato come il \inglese{pattern} più ad alto livello del nostro sistema. La distinzione fra \inglese{model}, \inglese{presenter} e \inglese{view} è infatti rispecchiata dalla suddivisione del sistema nelle tre sotto-architetture \texttt{server}, \texttt{clientpresenter} e \texttt{clientview}.

In generale, l'utilizzo di MVP riduce l'accoppiamento tra le sotto-architetture minimizzando le modifiche richieste a ognuno di essi come conseguenza di cambiamenti all'interno degli altri.

Inoltre, i componenti di questa sotto-architettura non sono vincolati a utilizzare la rete per accedere alle informazioni che sono memorizzate sul server quando queste sono già disponibili (e possono essere elaborate) sul client, migliorando quindi l'esperienza utente.

In particolare, le componenti del sistema che prendono parte alle collaborazioni previste dal \inglese{pattern} MVP sono
\begin{description}
  \item{\scshape\bfseries CS01 -- Gestione database}\\
Componente che ha il ruolo di gestire la persistenza dei dati sul server necessaria alla memorizzazione delle entità di interesse del modello dei dati.

  \item{\textsc{\bfseries CS06 -- Gestione chiamate}, \textsc{\bfseries Gestione rubrica} e \textsc{\bfseries Gestione segreteria}}\\
Contengono le rappresentazioni delle entità della \inglese{business logic} lato server, che devono essere interrogate per ricavare le informazioni necessarie ai client in forma opportuna.

  \item{\scshape\bfseries CS07-- Façade del server}\\
Componente del server interessato dalla ricezione delle richieste da parte dei \inglese{presenter}, recupera le informazioni di cui questi ultimi necessitano e le restituisce in forma serializzata e compatibile con il dominio applicativo dei client.

  \item{\scshape\bfseries CP04 -- Gestione remota}\\
Intercetta le comunicazioni entranti verso il client a partire dal server che non hanno origine in una richiesta esplicita da parte del client come, ad esempio, gli aggiornamenti di stato dei diversi utenti o le chiamate in ingresso.
  
  \item{\scshape\bfseries CP03 -- Gestione GUI}\\
Riceve i comandi dalla vista ed è responsabile del suo aggiornamento e dell'interrogazione del server nel momento in cui i dati necessari per popolare l'interfaccia utente non siano disponibili sul client. Questo componente integra al suo interno gli oggetti \inglese{presenter} specifici per ogni vista e ne gestisce la collaborazione.

  \item{\scshape\bfseries GUI}\\
Corrisponde all'insieme delle viste ed è accessibile al \inglese{presenter} tramite le DOM API di JavaScript.
\end{description}

\subsection{Observer}

\subsubsection{Scopo}
Definire una dipendenza uno a molti fra oggetti, in modo tale che se un oggetto cambia il suo stato tutti gli oggetti dipendenti da questo siano notificati e aggiornati automaticamente.

\subsubsection{Componenti che lo implementano}
\begin{description}
  \item{\scshape\bfseries CS07-- Gestione rubrica}\\
Il \inglese{pattern} Observer è utile in quanto permette agli utenti del sistema di osservare lo stato degli altri, ricevendo in modo automatico e trasparente una notifica nel caso in cui quest'ultimo subisse variazioni, essendo ogni utente sia osservato che osservatore.

A tal fine l'interfaccia \texttt{abook.IUserData} estende l'interfaccia \texttt{java.util.Observer} mentre la classe \texttt{UserData}, che implementa \texttt{abook.IUserData},  estende la classe di libreria \texttt{java.util.Observable}.

\begin{figure}[H]
  \centering
  \includegraphics[width=.7\textwidth]{pattern_observer}
  \caption{Applicazione del \inglese{pattern} Observer}\label{fig:observer}
\end{figure}

Al momento della connessione, ogni utente si registra come osservatore sui suoi contatti che sono \inglese{online} e, al contempo, li aggiunge tra i propri osservatori. Questo avviene tramite l'uso del metodo \texttt{addObserver(Observer)} ereditato dalla classe \texttt{java.util.Observable}.

%TODO chi e quando chiama questi metodi e su chi

In tal modo gli utenti notificano in \inglese{broadcast} le loro variazioni di stato e sono sempre aggiornati sullo stato dei contatti della loro rubrica. Tale notifica avviene sfruttando il metodo \texttt{notifyObservers(Object)} ereditato dalla classe \texttt{java.util.Observable}. L'oggetto passato come parametro corrisponde allo stato (\texttt{abook.State}) associato all'utente, in modo che gli osservatori abbiano conoscenza del nuovo stato che l'utente ha assunto.

\end{description}

\subsection{Singleton}

\subsubsection{Scopo}
Il \inglese{pattern} creazionale Singleton, garantisce che una determinata classe possa essere istanziata una sola volta, e di fornirne un punto di accesso globale. Questo \inglese{pattern} va utilizzato negli ambiti in cui si ha la necessità che l'accesso ad una determinata entità sia unico, in modo da permettere la gestione ottimale della risorsa stessa.

\subsubsection{Componenti che lo implementano}
\begin{description}
  \item{\scshape\bfseries CS01 -- Gestione database}\\
La classe \texttt{server.dao.HibernateUtil} è implementata come Singleton dal momento che si desidera che in ogni momento ne sia attiva un'unica istanza. Tramite i metodi che essa mette a disposizione, le classi DAO sono in grado di procurarsi un riferimento alla sessione di connessione al DBMS al fine di effettuare le transazioni di cui necessitano.

\begin{figure}[H]
  \centering
  \includegraphics[width=.6\textwidth]{pattern_singleton_dao}
  \caption{Applicazione del \inglese{pattern} Singleton a \textsf{Gestione database}}\label{fig:singleton2}
\end{figure}

  \item{\scshape\bfseries CP01 -- Gestione comunicazione}\\
La classe \texttt{clientpresenter.kernel.CommunicationCenter} è implementata secondo il \inglese{pattern} Singleton in modo da limitare il numero di istanze presenti su ciascun client a una soltanto. In tal modo è possibile centralizzare la gestione delle comunicazioni in ingresso e in uscita, tanto verso il server quanto verso gli altri client.

\begin{figure}[H]
  \centering
  %\includegraphics[width=.6\textwidth]{pattern_singleton_comunicazione}
  \caption{Applicazione del \inglese{pattern} Singleton a \textsf{Gestione comunicazione}}\label{fig:singleton1}
\end{figure}

  \item{\scshape\bfseries CP04 -- Gestione remota}\\
Il \inglese{pattern} Singleton è altresì utile per controllare il numero di istanze attive della classe \texttt{clientpresenter.kernel.RemoteHandler} per gli stessi motivi evidenziati in precedenza, ossia l'unicità del punto di accesso alle funzionalità della sotto-architettura \texttt{clientpresenter}.

\begin{figure}[H]
  \centering
  \includegraphics[width=.6\textwidth]{pattern_singleton_gestione_remota}
  \caption{Applicazione del \inglese{pattern} Singleton a \textsf{Gestione remota}}\label{fig:singleton3}
\end{figure}

\end{description}
\clearpage

\section{Diagrammi delle attività}
In questa sezione saranno descritti i diagrammi di attività che rappresentano il flusso di utilizzo dei vari servizi messi a disposizione dal prodotto \caName.

\subsection{Diagramma di attività generale}

Il diagramma in figura \vref{fig:ADhome} rappresenta il flusso principale dell'applicazione \caName. Innanzitutto, l'accesso alle funzionalità del sistema è vincolato allo svolgimento con successo dell'azione di autenticazione, illustrata con maggiori dettagli nel diagramma di sotto-attività \vref{fig:ADautenticazione}.

\begin{figure}[H]
\centering
\includegraphics[width=.8\textwidth]{home}
\caption{Diagramma di attività generale che descrive l'interazione con il sistema}\label{fig:ADhome}
\end{figure}

A seguito dell'autenticazione, diviene possibile scegliere una fra le azioni di amministrazione, vale a dire
\begin{itemize}[noitemsep,nolistsep]
  \item[-] scelta lingua GUI;
  \item[-] gestione segreteria (illustrata dal diagramma \ref{fig:ADgestionesegreteria});
  \item[-] gestione rubrica (illustrata dal diagramma \ref{fig:ADgestionerubrica});
  \item[-] gestione account (illustrata dal diagramma \ref{fig:ADgestioneaccount});
  \item[-] gestione dello stato personale;
\end{itemize}
oppure di consultazione informazioni, in particolare:
\begin{itemize}[noitemsep,nolistsep]
  \item[-] visualizzazione dello storico delle chiamate;
  \item[-] visualizzazione della rubrica;
  \item[-] ricerca di un utente.
\end{itemize}

A partire infine dalla visualizzazione del profilo di un utente, cui è possibile accedere tanto tramite una ricerca quanto dall'elenco dei contatti in rubrica, è possibile dare inizio a una comunicazione (diagramma \vref{fig:ADconnessione}).

\subsection{Diagrammi di attività Autenticazione}
Il diagramma riportato in figura \vref{fig:ADautenticazione} illustra la sotto-attività di autenticazione di un utente al sistema. A partire dalla schermata iniziale è possibile inserire le proprie credenziali di accesso al sistema se ne si è provvisti, richiederle se è la prima volta che si effettua l'accesso al sistema (avviando la procedura di registrazione riportata in figura \ref{fig:ADregistrazione}) oppure recuperarle (sotto-attività in figura \vref{fig:ADrecuperopassword}).

\begin{figure}[H]
  \centering
  \includegraphics[width=.8\textwidth]{autent}
  \caption{Diagramma di attività relativo all'autententicazione}\label{fig:ADautenticazione}
\end{figure}

\subsubsection{Diagramma di attività Registrazione}
In dettaglio, la registrazione di un utente al sistema (fig.~\vref{fig:ADregistrazione}) prevede l'inserimento di una serie di dati alcuni dei quali obbligatori (indirizzo email, password, domanda segreta e relativa risposta) e altri facoltativi (nome, cognome e immagine del profilo). Al termine della procedura di registrazione l'utente dispone di un account personale e delle credenziali di accesso allo stesso.

\begin{figure}[H]
  \centering
  \includegraphics[width=.6\textwidth]{registrazione}
  \caption{Diagramma di attività relativo alla registrazione}\label{fig:ADregistrazione}
\end{figure}

\subsubsection{Diagramma di attività Recupero password}
Il recupero della password (fig.~\vref{fig:ADrecuperopassword}) prevede invece l'inserimento dell'email, la visualizzazione della domanda segreta impostata in fase di creazione dell'account e l'inserimento della relativa risposta. In caso di risposta corretta si ha il termine della sotto-attività con l'invio dei dati richiesti via email, in caso contrario la procedura deve essere ripetuta.

\begin{figure}[H]
  \centering
  \includegraphics[width=.6\textwidth]{recPass}
  \caption{Diagramma di attività relativo al recupero della password}\label{fig:ADrecuperopassword}
\end{figure}

\subsection{Diagramma di attività Gestione rubrica}
La sotto-attività di gestione (diagramma in fig.~\vref{fig:ADgestionerubrica}) della rubrica prevede l'accesso a due classi di azioni, a seconda che sia o meno richiesta da parte dell'utente una conferma esplicita per il completamento dell'attività.

In particolare, la prima categoria di azioni comprende:
\begin{itemize}[noitemsep,nolistsep]
  \item[-] l'aggiunta di un contatto alla rubrica;
  \item[-] l'ordinamento della rubrica;
  \item[-] l'eliminazione di un contatto;
  \item[-] la ricerca di un contatto;
  \item[-] l'inserimento di un contatto in un gruppo;
\end{itemize}
mentre la seconda categoria raggruppa azioni quali:
\begin{itemize}[noitemsep,nolistsep]
  \item[-] l'eliminazione di un gruppo;
  \item[-] la modifica di un gruppo;
  \item[-] l'importazione della rubrica da un file locale in formato XML;
  \item[-] l'esportazione della rubrica personale in un file XML.
\end{itemize}

La risposta affermativa alla domanda di conferma in seguito alla scelta di un'azione della seconda categoria porta alla conclusione della sotto-attività, mentre una risposta negativa comporta la scelta di una nuova azione amministrativa.

\begin{figure}[H]
  \centering
  \includegraphics[width=.8\textwidth]{gestRubrica}
  \caption{Diagramma di attività relativo alla gestione della rubrica personale}\label{fig:ADgestionerubrica}
\end{figure}

\subsection{Diagramma di attività Gestione account personale}
La gestione dell'account personale (fig.~\vref{fig:ADgestioneaccount}) comporta in primo luogo la visualizzazione di una schermata che mette a disposizione le operazioni disponibili, quindi la scelta di una di queste ultime. Le azioni che possono essere effettuate sono, in particolare:
\begin{itemize}[noitemsep,nolistsep]
  \item[-] modifica della password utente;
  \item[-] modifica dei dati anagrafici;
  \item[-] modifica dell'immagine del profilo;
  \item[-] modifica della domanda segreta e/o della relativa risposta per il recupero della password.
\end{itemize}

Al termine dell'operazione è prevista la visualizzazione di una domanda di conferma e, in caso di risposta affermativa da parte dell'utente, la modifica va a buon fine. In caso contrario, l'operazione non sortisce alcun effetto e si ritorna alla possibilità di scegliere l'azione amministrativa da effettuare.

\begin{figure}[H]
  \centering
  \includegraphics[width=.8\textwidth]{gestAccount}
  \caption{Diagramma di attività relativo alla gestione dei dati dell'account personale}\label{fig:ADgestioneaccount}
\end{figure}

\subsection{Diagramma di attività Gestione segreteria}
La gestione della segreteria prevede la scelta fra le seguenti azioni:
\begin{itemize}[noitemsep,nolistsep]
 \item[-] ascoltare un messaggio della segreteria;
 \item[-] cancellare un messaggio;
 \item[-] impostare lo stato (ascoltato/non ascoltato) di un messaggio;
\end{itemize}

Compiere una di queste azioni comporta l'uscita dalla sotto-attività ma l'esecuzione di più di una di queste azioni in sequenza è comunque possibile grazie al \inglese{merge} antecedente l'azione ``Visualizza attività'' nel diagramma di attività generale riportato in figura \vref{fig:ADhome}.

\begin{figure}[H]
  \centering
  \includegraphics[width=.8\textwidth]{gestSegreteria}
  \caption{Diagramma di attività relativo alla gestione della segretria}\label{fig:ADgestionesegreteria}
\end{figure}

\subsection{Diagrammi di attività Connessione}
L'utente ha inoltre la possibilità di connettersi con altri utenti tramite l'attività di connessione.

Come si evince dal diagramma riportato in figura \vref{fig:ADconnessione}, la comunicazione con un utente dipende intrinsecamente dallo stato in cui si trova: se questo è \inglese{offline} oppure \inglese{online} ma occupato, può essere raggiunto in maniera indiretta solo tramite la segreteria telefonica (diagramma \ref{fig:ADmessegreteria}), mentre se l'utente è disponibile può essere contattato immediatamente.

\begin{figure}[H]
  \centering
  \includegraphics[width=.8\textwidth]{connessione}
  \caption{Diagramma di attività relativo alla connessione}\label{fig:ADconnessione}
\end{figure}

Esistono tre tipologie di comunicazione a seconda del mezzo utilizzato:
\begin{itemize}[noitemsep,nolistsep]
  \item[-] audio (illustrata nel diagramma in fig.~\ref{fig:ADcomaudio});
  \item[-] audio/video (diagramma in fig.~\ref{fig:ADcomaudiovideo});
  \item[-] testuale (diagramma in fig.~\ref{fig:ADcomtestuale});
\end{itemize}


Tutte e tre le tipologie di connessione prevedono la condivisione di risorse, secondo le modalità riportate in figura \ref{fig:ADcondrisorse}. Inoltre, nel corso di una comunicazione di tipo audio oppure audio/video è possibile registrare una chiamata, secondo me modalità riportate in figura \ref{fig:ADregistrachiamata} nonché visualizzare le statistiche sulla comunicazione corrente (diagramma in fig.~\vref{fig:ADstatistiche}).

\subsubsection{Diagramma di attività Comunicazione audio}
La comunicazione audio (fig.~\vref{fig:ADcomaudio}) prevede la possibilità svolgimento di più azioni in parallelo, in particolare la registrazione, la condivisione di risorse, una comunicazione testuale e la visualizzazione delle statistiche sulla comunicazione in corso. Inoltre, a discrezione dell'utente, una comunicazione audio può essere promossa in una comunicazione audio/video oppure può essere estesa a nuovi partecipanti.

\begin{figure}[H]
  \centering
  \includegraphics[width=.8\textwidth]{comAudio}
  \caption{Diagramma di attività relativo alla comunicazione audio}\label{fig:ADcomaudio}
\end{figure}

\subsubsection{Diagramma di attività Comunicazione audio/video}
La comunicazione audio/video (fig.~\vref{fig:ADcomaudiovideo}) prevede la possibilità svolgimento di più azioni in parallelo, in particolare la registrazione, la condivisione di risorse, una comunicazione testuale e la visualizzazione delle statistiche sulla comunicazione in corso. Inoltre, a discrezione dell'utente, una comunicazione audio/video può essere declassata in una comunicazione audio semplice oppure può essere estesa a nuovi partecipanti.

\begin{figure}[H]
  \centering
  \includegraphics[width=.8\textwidth]{comAudioVideo}
  \caption{Diagramma di attività relativo alla comunicazione audio/video}\label{fig:ADcomaudiovideo}
\end{figure}

\subsubsection{Diagramma di attività Comunicazione testuale}
La comunicazione testuale, come illustrato dal diagramma riportato in figura \vref{fig:ADcomtestuale} può avvenire in parallelo con una condivisione di risorse, può essere promossa a comunicazione audio o audio/video e può essere estesa a più partecipanti. Non è prevista, durante una comunicazione testuale, la possibilità di visualizzare statistiche sulla comunicazione o di registrare la stessa in forma persistente.

\begin{figure}[H]
  \centering
  \includegraphics[width=.8\textwidth]{comTestuale}
  \caption{Diagramma di attività relativo alla comunicazione testuale}\label{fig:ADcomtestuale}
\end{figure}

\subsubsection{Diagramma di attività Condivisione di risorse}
La sotto-attività di condivisione (fig.~\vref{fig:ADcomtestuale}) di risorse comporta la possibilità di scegliere se condividere un file PDF, un file oppure lo schermo con gli altri partecipanti ad una comunicazione audio, audio/video oppure testuale.

\begin{figure}[H]
  \centering
  \includegraphics[width=.8\textwidth]{condRisorse}
  \caption{Diagramma di attività relativo alla condivisione di risorse}\label{fig:ADcondrisorse}
\end{figure}

\subsubsection{Diagramma di attività Registrazione chiamata}
La registrazione di una chiamata (fig.~\vref{fig:ADregistrachiamata}), sotto-attività cui è possibile accedere solo durante una comunicazione audio oppure audio/video, comporta innanzitutto l'inoltro di una richiesta di registrazione agli altri partecipanti della chiamata. Se si ottiene il consenso da parte di tutti, la registrazione ha inizio e prosegue fino a che non viene esplicitamente terminata. Se invece almeno uno degli utenti coinvolti non dà il proprio consenso alla registrazione, questa non può avere luogo.

\begin{figure}[H]
  \centering
  \includegraphics[width=.8\textwidth]{regChiamata}
  \caption{Diagramma di attività relativo alla registrazione della chiamata}\label{fig:ADregistrachiamata}
\end{figure}

\subsubsection{Diagramma di attività Statistiche comunicazione}
Nel corso di una comunicazione multimediale è possibile visualizzare una serie di informazioni (fig.~\vref{fig:ADstatistiche})fra cui:
\begin{itemize}[noitemsep,nolistsep]
  \item[-] il numero di byte inviati e ricevuti;
  \item[-] la velocità di trasmissione;
  \item[-] la latenza della connessione;
  \item[-] il numero di fps (nel caso delle sole comunicazioni video).
\end{itemize}

\begin{figure}[H]
  \centering
  \includegraphics[width=.8\textwidth]{statistCom}
  \caption{Diagramma di attività relativo alla visualizzazione delle statistiche della comunicazione}\label{fig:ADstatistiche}
\end{figure}

\subsubsection{Diagramma di attività Messaggio in segreteria}
In conclusione, si ricorda che è possibile lasciare un messaggio nella segreteria di un determinato contatto se non presente in linea nel momento in cui desideriamo comunicare con lui \ref{fig:ADmessegreteria}. I messaggi che possono essere lasciati in segreteria possono essere costituiti da una sola traccia audio oppure da una traccia audio e da una traccia video.

\begin{figure}[H]
  \centering
  \includegraphics[width=.8\textwidth]{segreteria}
  \caption{Diagramma di attività relativo alla memorizzazione di un messaggio in segreteria}\label{fig:ADmessegreteria}
\end{figure}
\clearpage

\section{Tracciamenti}\label{sec:tracciamenti}
Nella seguente sezione vengono proposti tutti i tracciamenti eseguiti mediante il sistema \manager. I tracciamenti proposti sono giustificati dalle seguenti due motivazioni:

\begin{itemize}
	\item Dimostrare il soddisfacimento per necessità e sufficienza della corrispondenza tra gli elementi tracciati (e.g. un componente deve rispondere necessariamente alle esigenze di uno o più requisiti, tali insomma che ne giustifichino l'esistenza. D'altro canto è richiesto che ogni requisito definito in fase d'analisi sia soddisfatto e risolto da almeno un componente).
	\item dare una lettura generale delle varie: componenti, requisiti, \inglese{design pattern} e classi.
\end{itemize}

\input{tracciamenti.tex}

\end{document}

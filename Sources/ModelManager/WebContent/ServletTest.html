<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns = "http://www.w3.org/1999/xhtml" xml:lang = "it" lang = "it">
	<head>
	 	<meta http-equiv = "Content-Type" content = "text/html; UTF-8"/>
		<title>Test servlet - MyTalk - SoftwareSynthesis</title>
		<script type = "text/javascript">
			function callServlet(servletURI, parameters)
			{
				if (parameters == null)
					parameters = "";
				var request = new XMLHttpRequest();
				request.open("POST", servletURI, false);
				request.setRequestHeader("Content-type", "application/x-www-fomr-urlencoded");
				request.send(parameters);
				return request.responseText;
			}
			
			function printResult(identifier, result)
			{
				var cella = document.getElementById(identifier);
				if (result == true)
				{
					cella.style.backgroundColor = "#00FF00";
				}
				else
				{
					cella.style.backgroundColor = "#CC0000";	
				}
			}
			
			function loginAuthentication()
			{
				var username = "indirizzo5@dominio.it";
				var password = "password";
				var servletURI = "http://localhost:8080/MyTalk/LoginAuthentication";
				var parameters = "username=" + username + "&password=" + password;
				var result = callServlet(servletURI);
				var parsed = JSON.parse(result);
				try
				{
					if (parsed.name == "luigi" && parsed.surname == "mannoio" && parsed.email == "indirizzo5@dominio.it")
					{
						printResult("LoginAuthentication", true);
					}
					else
					{
						printResult("LoginAuthentication", false);
					}
				}
				catch (exception)
				{
					printResult("LoginAuthentication", false);
				}
			}
			
			function loginClose()
			{
				var servletURI = "http://localhost:8080/MyTalk/LoginClose";
				var result = callServlet(servletURI, parameters);
				var parsed = JSON.parse(result);
				try
				{
					if (parsed == true)
					{
						printResult("LoginClose", true);
					}
					else
					{
						printResult("LoginClose", false);
					}
				}
				catch (exception)
				{
					printResult("LoginClose", false);
				}
			}
			
			function loginDoRegistration()
			{
				var username = "andrea@dominio.it";
				var password = "password";
				var question = "come mi chiamo";
				var answer = "Andrea";
				var name = "andrea";
				var surname = "meneghinello";
				var servletURI = "http://localhost:8080/MyTalk/LoginDoRegistration";
				var parameters = "username=" + username + "&password=" + password + "&question=" + question + "&answer=" + answer + "&name=" + name + "&surname=" + surname;
				var result = callServlet(servletURI, parameters);
				var parsed = JSON.parse(result);
				try
				{
					if (parsed == true)
					{
						printResult("LoginDoRegistration", true);
					}
					else
					{
						printResult("LoginDoRegistration", false);
					}
				}
				catch (exception)
				{
					printResult("LoginDoRegistration", false);
				}
			}
			
			function addressBookGetContacts()
			{
				var servletURI = "http://localhost:8080/MyTalk/addressBookGetContacts";
				var result = callServlet(servletURI);
				var parsed = JSON.parse(result);
				try
				{
					for (var key in parsed)
					{
						if (parsed[key].email = "indirizzo2@dominio.it")
						{
							printResult("AddressBookGetContacts", true);
							return;
						}
					}
					printResult("AddressBookGetContacts", false);
				}
				catch (exception)
				{
					printResult("AddressBookGetContacts", false);
				}
			}
		</script>
	</head>
	<body>
		<h1>Test delle servlet di MyTalk</h1>
		<table border = "1px">
			<tr>
				<th style = "width:200px;">Nome della servlet</th>
				<th style = "width:200px;">Esito del test</th>
				<th>Opioni</th>
			</tr>
			<tr>
				<td colspan = "3" style = "color:#C00; text-align:center;">package authentication.servlet</td>
			</tr>
			<tr>
				<td>LoginAuthentication</td>
				<td id = "LoginAuthentication"></td>
				<td><button onclick = "loginAuthentication()">Avvia test</button></td>
			</tr>
			<tr>
				<td>LoginClose</td>
				<td id = "LoginClose"></td>
				<td><button onclick = "loginClose()">Avvia test</button></td>
			</tr>
			<tr>
				<td>LoginDoRegistration</td>
				<td id = "LoginDoRegistration"></td>
				<td><button onclick = "loginDoRegistration()">Avvia test</button></td>
			</tr>
			<tr>
				<td colspan = "3" style = "text-align:center; color:#C00;">package abook.servlet</td>
			</tr>
			<tr>
				<td>AddressBookGetContacts</td>
				<td id = "AddressBookGetContacts"></td>
				<td><button onclick = "addressBookGetContacts()">Avvia test</button></td>
			</tr>
		</table>
	</body>
</html>
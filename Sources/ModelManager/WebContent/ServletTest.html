<!DOCTYPE html>
<html xmlns = "http://www.w3.org/1999/xhtml" lang = "it">
	<head>
	 	<meta http-equiv = "Content-Type" content = "text/html; UTF-8"/>
		<title>Test servlet - MyTalk - SoftwareSynthesis</title>
		<script type = "text/javascript">
			function callServlet(servletURI, parameters)
			{
				if (parameters == null)
					parameters = "";
				var request = new XMLHttpRequest();
				request.open("POST", servletURI, false);
				request.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
				request.send(parameters);
				return request.responseText;
			}
			
			function printResult(identifier, result)
			{
				var cella = document.getElementById(identifier);
				if (result == true)
				{
					cella.style.backgroundColor = "#00FF00";
				}
				else
				{
					cella.style.backgroundColor = "#CC0000";	
				}
			}
			
			function callAllTest()
			{
				loginAuthentication();
				loginDoRegistration();
				
				addressBookGetContacts();
				addressBookDoAddContact();
				addressBookDoRemoveContact();
				addressBookDoInsertInGroup();
				addressBookDoRemoveFromGroup();
				addressBookDoCreateGroup();
				addressBookDoDeleteGroup();
				addressBookDoBlock();
				addressBookDoUnblock();
				addressBookGetGroups();
				
				loginClose();
			}
			
			function loginAuthentication()
			{
				var username = "indirizzo5@dominio.it";
				var password = "password";
				var servletURI = "http://localhost:8080/MyTalk/LoginAuthentication";
				var parameters = "username=" + username + "&password=" + password;
				var result = callServlet(servletURI, parameters);
				var parsed = JSON.parse(result);
				try
				{
					if (parsed.name == "luigi" && parsed.surname == "mannoio" && parsed.email == "indirizzo5@dominio.it")
					{
						printResult("LoginAuthentication", true);
					}
					else
					{
						printResult("LoginAuthentication", false);
					}
				}
				catch (exception)
				{
					printResult("LoginAuthentication", false);
				}
			}
			
			function loginClose()
			{
				var servletURI = "http://localhost:8080/MyTalk/LoginClose";
				var result = callServlet(servletURI);
				var parsed = JSON.parse(result);
				try
				{
					if (parsed == true)
					{
						printResult("LoginClose", true);
					}
					else
					{
						printResult("LoginClose", false);
					}
				}
				catch (exception)
				{
					printResult("LoginClose", false);
				}
			}
			
			function loginDoRegistration()
			{
				var username = "andrea@dominio.it";
				var password = "password";
				var question = "come mi chiamo";
				var answer = "Andrea";
				var name = "andrea";
				var surname = "meneghinello";
				var servletURI = "http://localhost:8080/MyTalk/LoginDoRegistration";
				var parameters = "username=" + username + "&password=" + password + "&question=" + question + "&answer=" + answer + "&name=" + name + "&surname=" + surname;
				var result = callServlet(servletURI, parameters);
				var parsed = JSON.parse(result);
				try
				{
					if (parsed == true)
					{
						printResult("LoginDoRegistration", true);
					}
					else
					{
						printResult("LoginDoRegistration", false);
					}
				}
				catch (exception)
				{
					printResult("LoginDoRegistration", false);
				}
			}
			
			function addressBookGetContacts()
			{
				var servletURI = "http://localhost:8080/MyTalk/addressBookGetContacts";
				var result = callServlet(servletURI);
				var parsed = JSON.parse(result);
				try
				{
					for (var key in parsed)
					{
						if (parsed[key].email = "indirizzo2@dominio.it")
						{
							printResult("AddressBookGetContacts", true);
							return;
						}
					}
					printResult("AddressBookGetContacts", false);
				}
				catch (exception)
				{
					printResult("AddressBookGetContacts", false);
				}
			}
			
			function addressBookDoAddContact()
			{
				var servletURI = "http://localhost:8080/MyTalk/addressBookDoAddContact";
				var contactId = 1;
				var parameters = "contactId=" + contactId;
				var result = callServlet(servletURI, parameters);
				var parsed = JSON.parse(result);
				try
				{
					if (parsed ==  true)	
					{
						printResult("AddressBookDoAddContact", true);
					}
					else
					{
						printResult("AddressBookDoAddContact", false);
					}
				}
				catch (exception)
				{
					printResult("AddressBookDoAddContact", false);
				}
			}
			
			function addressBookDoRemoveContact()
			{
				var servletURI = "http://localhost:8080/MyTalk/addressBookDoRemoveContact";
				var parameters = "contactId=" + 1;
				var result = callServlet(servletURI, parameters);
				var parsed = JSON.parse(result);
				try
				{
					if (parsed == true)
					{
						printResult("AddressBookDoRemoveContact", true);	
					}
					else
					{
						printResult("AddressBookDoRemoveContact", false);
					}
					
				}
				catch (exception)
				{
					printResult("AddressBookDoRemoveContact", false);
				}
			}
			
			function addressBookDoInsertInGroup()
			{
				var servletURI = "http://localhost:8080/MyTalk/addressBookDoInsertInGroup";
				var parameters = "contactId=" + 2 + "&groupId=" + 2;
				var result = callServlet(servletURI, parameters);
				var parsed = JSON.parse(result);
				try
				{
					if (parsed == true)
					{
						printResult("AddressBookDoInsertInGroup", true);
					}
					else
					{
						printResult("AddressBookDoInserInGroup", false);
					}
				}
				catch (exception)
				{
					printResult("AddressBookDoInsertInGroup", false);
				}
			}
			
			function addressBookDoRemoveFromGroup()
			{
				var servletURI = "http://localhost:8080/MyTalk/addressBookDoRemoveFromGroup";
				var parameters = "contactId=" + 2 + "&groupId=" + 2;
				var result = callServlet(servletURI, parameters);
				var parsed = JSON.parse(result);
				try
				{
					if (parsed == true)
					{
						printResult("AddressBookDoRemoveFromGroup", true);
					}
					else
					{
						printResult("AddressBookDoRemoveFromGroup", false);
					}
				}
				catch (exception)
				{
					printResult("AddressBookDoRemoveFromGroup", false);
				}
			}
			
			function addressBookDoCreateGroup()
			{
				var servletURI = "http://localhost:8080/MyTalk/addressBookDoCreateGroup";
				var parameters = "groupName=" + "GruppoTest";
				var result = callServlet(servletURI, parameters);
				var parsed = JSON.parse(result);
				try
				{
					if (parsed == true)
					{
						printResult("AddressBookDoCreateGroup", true);
					}
					else
					{
						printResult("AddressBookDoCreateGroup", false);
					}
				}
				catch (exception)
				{
					printResult("AddressBookDoCreateGroup", false);
				}
			}
			
			function addressBookDoDeleteGroup()
			{
				var servletURI = "http://localhost:8080/MyTalk/addressBookDoDeleteGroup";
				var parameters = "groupId=" + 16;
				var result = callServlet(servletURI, parameters);
				var parsed = JSON.parse(result);
				try
				{
					if (parsed == true)
					{
						printResult("AddressBookDoDeleteGroup", true);
					}
					else
					{
						printResult("AddressBookDoDeleteGroup", false);
					}
				}
				catch (exception)
				{
					printResult("AddressBookDoDeleteGroup", false);
				}
			}
			
			function addressBookDoBlock()
			{
				var servletURI = "http://localhost:8080/MyTalk/addressBookDoBlock";
				var parameters = "contactId=" + 4;
				var result = callServlet(servletURI, parameters);
				var parsed = JSON.parse(result);
				try
				{
					if (parsed == true)
					{
						printResult("AddressBookDoBlock", true);
					}
					else
					{
						printResult("AddressBookDoBlock", false);
					}
				}
				catch (exception)
				{
					printResult("AddressBookDoBlock", false);
				}
			}
			
			function addressBookDoUnblock()
			{
				var servletURI = "http://localhost:8080/MyTalk/addressBookDoUnblock";
				var parameters = "contactId=" + 4;
				var result = callServlet(servletURI, parameters);
				var parsed = JSON.parse(result);
				try
				{
					if (parsed == true)
					{
						printResult("AddressBookDoUnblock", true);
					}
					else
					{
						printResult("AddressBookDoUnblock", false);
					}
				}
				catch (exception)
				{
					printResult("AddressBookDoUnblock", false);
				}
			}
			
			function addressBookGetGroups()
			{
				var servletURI = "http://localhost:8080/MyTalk/addressBookGetGroups";
				var result = callServlet(servletURI);
				var parsed = JSON.parse(result);
				try
				{
					for (var key in parsed)
					{
						if (parsed[key].name == "Gruppo 1")
						{
							printResult("AddressBookGetGroups", true);
							return;
						}
					}
					printResult("AddressBookGetGroups", false);
				}
				catch (exception)
				{
					printResult("AddressBookGetGroups", false);
				}
			}
		</script>
	</head>
	<body>
		<h1>Test delle servlet di MyTalk</h1>
		<table border = "1">
			<tr>
				<th style = "width:200px;">Nome della servlet</th>
				<th style = "width:200px;">Esito del test</th>
			</tr>
			<tr>
				<td colspan = "2" style = "color:#C00; text-align:center;">package authentication.servlet</td>
			</tr>
			<tr>
				<td>LoginAuthentication</td>
				<td id = "LoginAuthentication"></td>
			</tr>
			<tr>
				<td>LoginClose</td>
				<td id = "LoginClose"></td>
			</tr>
			<tr>
				<td>LoginDoRegistration</td>
				<td id = "LoginDoRegistration"></td>
			</tr>
			<tr>
				<td colspan = "2" style = "text-align:center; color:#C00;">package abook.servlet</td>
			</tr>
			<tr>
				<td>AddressBookGetContacts</td>
				<td id = "AddressBookGetContacts"></td>
			</tr>
			<tr>
				<td>AddressBookDoAddContact</td>
				<td id = "AddressBookDoAddContact"></td>
			</tr>
			<tr>
				<td>AddressBookDoRemoveContact</td>
				<td id = "AddressBookDoRemoveContact"></td>
			</tr>
			<tr>
				<td>AddressBookDoInsertInGroup</td>
				<td id = "AddressBookDoInsertInGroup"></td>
			</tr>
			<tr>
				<td>AddressBookDoRemoveFromGroup</td>
				<td id = "AddressBookDoRemoveFromGroup"></td>
			</tr>
			<tr>
				<td>AddressBookDoCreateGroup</td>
				<td id = "AddressBookDoCreateGroup"></td>
			</tr>
			<tr>
				<td>AddressBookDoDeleteGroup</td>
				<td id = "AddressBookDoDeleteGroup"></td>
			</tr>
			<tr>
				<td>AddressBookDoBlock</td>
				<td id = "AddressBookDoBlock"></td>
			</tr>
			<tr>
				<td>AddressBookDoUnblock</td>
				<td id = "AddressBookDoUnblock"></td>
			</tr>
			<tr>
				<td>AddressBookGetGroups</td>
				<td id = "AddressBookGetGroups"></td>
			</tr>
		</table>
		<br />
		<button onclick = "callAllTest()">AVVIA TUTTI I TEST</button>
	</body>
</html>